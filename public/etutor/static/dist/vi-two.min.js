/*! vi-lab 2016-11-21 */
function delegate(a,b){var c=function(){var a=arguments.callee.target,b=arguments.callee.func;return b.apply(a,arguments)};return c.target=a,c.func=b,c}function removeDuplicates(a){a=a.sort();for(var b=1;b<a.length;)a[b-1]==a[b]?a.splice(b,1):b++;return a}function timeDifference(a,b,c){var d=moment(a),e=moment(a),f=e.diff(d,"seconds");return f<=60?b+f.toFixed(1)+"s"+c:(f=e.diff(d,"minutes"),f<=60?b+f.toFixed(1)+"min"+c:(f=e.diff(d,"hours",!0),f<=24?b+f.toFixed(1)+"h"+c:(f=e.diff(d,"days",!0),f<30?b+f.toFixed(1)+"d"+c:(f=e.diff(d,"months",!0),f<12?b+f.toFixed(1)+"m"+c:(f=e.diff(d,"years",!0),b+f.toFixed(1)+"y"+c)))))}Vi2.Observer=$.inherit({__constructor:function(a){vi2.observer=this,this.options=$.extend(this.options,a),this.widget_list={},this.clock=new Vi2.Clock(this.options.clockInterval)},name:"observer",options:{id:"start",embed:!0,selector:"#screen",clockInterval:500,videoSelector:"#video1",videoWidth:500,videoHeight:375,videoControlsSelector:".video-controls",markupType:"wiki",childtheme:""},pieList:$("<ul></ul>").attr("class","pieContextMenu").attr("id","menu"),player:void 0,clock:void 0,parseSelector:"",widget:void 0,widget_list:[],hooks:[],vid_arr:[],current_stream:"start",seek:0,parser:"",setCurrentStream:function(a,b){this.current_stream=a,this.seek=b;$("<div></div>").attr("type","video").attr("starttime",0).attr("duration",7).attr("id","myvideo").text(vi2.db.getStreamById(a).video).appendTo("#vi2");this.clock.stopClock(),this.clock.reset();new Vi2.Metadata;this.parse(vi2.dom,"html")},parse:function(a,b){this.parseSelector=a,this.parser=new Parser(a,null===b?this.markupType:b),this.vid_arr=[],this.vid_arr=this.parser.run(),this.clock.stopClock(),this.clock.reset(),this.player.loadSequence(this.vid_arr,0,this.seek)},init:function(a){var b=this;this.player=new Video({embed:this.options.embed,selector:this.options.videoSelector,width:this.options.videoWidth,height:this.options.videoHeight,videoControlsSelector:this.options.videoControlsSelector,theme:this.options.theme,childtheme:this.options.childtheme,thumbnail:this.options.thumbnail,seek:void 0===a?0:a},this),$(this).bind("player.ready",function(a,c,d){b.setAnnotations()})},setAnnotations:function(){var a=this;this.clock.annotations=[],this.vid_arr=this.parser.run(),$.each(a.vid_arr[0].annotation,function(b,c){a.clock.addAnnotation(c)}),$.each(a.widget_list,function(b,c){"player-widget"!==c.type?c.init(a.vid_arr[0].annotation):c.init()})},updateLocation:function(a,b){window.location.replace(window.location.href.split("#")[0]+"#!"+a+":"+b.replace(/\ /g,"_"))},addWidget:function(a){switch(a.player=this.player,this.clock.addHook(a.name,a),"annotation"===a.type&&(a.appendToDOM(this.current_stream),$(this.player).bind("annotation.begin."+a.name,function(b,c,d){a.begin(b,c,d)}),$(this.player).bind("annotation.end."+a.name,function(b,c,d){a.end(b,c,d)})),a.name){case"relatedVideos":$(this.player).bind("video.end",function(b,c){a.showLinkSummary()});break;case"log":$(this.player).bind("log",function(b,c){a.add(c)})}return this.widget_list[a.name]=a,!0},isWidget:function(a){return null!==this.widget_list[a]},getWidget:function(a){return this.widget_list[a]},removeWidget:function(a){this.widget_list[a]=0},annotationsToDOM:function(){var a=this;$.each(this.widget_list,function(b,c){"annotation"===c.type&&c.appendToDOM(a.current_stream)})},ended:function(){},pause:function(){this.clock.stopClock()},play:function(){},log:function(a){$(this.player).trigger("log",[a])},destroy:function(){$("video").stop(),this.clock.reset(),$("#vi2").empty()}}),Vi2.Log=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a),this.userAgent=this.getUserAgent()},name:"log",options:{output:"logfile",debug_selector:"#debug",prefix:"",logfile:"log.txt",parameter:"time,ip,msg,user",logger_path:"-1"},bucket:"",ip:"",init:function(){},add:function(a){if("string"==typeof a)return void console.log("warning: uncaptured log emtrie: "+a);var b=vi2.observer.player.currentTime();t=new Date,t=t.getTime();var c={utc:t,user:vi2.userData.id,video_id:vi2.currentVideo,action:a,playback_time:void 0===b?-1:b,user_agent:this.getUserAgent()};this.writeLog(c)},getLogs:function(){return this.bucket},getLogTime:function(){var a=new Date,b=a.getSeconds(),c=a.getMinutes(),d=a.getHours(),e=a.getDate(),f=a.getMonth()+1,g=a.getFullYear();return{utc:a.getTime(),date:g+"-"+(f<=9?"0"+f:f)+"-"+(e<=9?"0"+e:e),time:(d<=9?"0"+d:d)+":"+(c<=9?"0"+c:c)+":"+(b<=9?"0"+b:b)+":"+a.getMilliseconds()}},getIP:function(){return this.ip},getUserAgent:function(){$.browser;return navigator.userAgent.replace(/,/g,";")},writeLog:function(a){"-1"!==this.options.logger_path&&$.post(this.options.logger_path,{data:a},function(a){})}}),Vi2.DataBase=$.inherit({__constructor:function(a,b,c,d){this.call_back=b;var e=this;this.options=$.extend(this.options,a),this._d=0,$.each(this.options.jsonFiles,function(a,b){console.log("making requst for "+b.path),e.loadJSON(b.path,b.storage,c)})},name:"dataBase",options:{path:"",jsonFiles:[]},call_back:{},_d:0,json_data:{},json_slide_data:{},json_user_data:{},content_selector:"#content",dom:"#hydro1",loadJSON:function(a,b,c){var d=this;$.ajax({type:"get",beforeSend:function(a){a.overrideMimeType&&a.overrideMimeType("application/json")},url:d.options.path+a,dataType:"json",success:function(a){d[b]=a,d._d++,d._d===Object.size(d.options.jsonFiles)&&(console.log("done"),d.call_back[c]())},error:function(a){window.location="/login";new Error("Could not catch data")}})},isStream:function(a){var b=!1;return $.each(this.json_data,function(c){this.id===a&&(b=!0)}),b},getStreamById:function(a){return void 0===this.json_data?{}:this.json_data},getAllCategories:function(){return this.json_data.categories},getCategoryTaxonomie:function(){var a={};return $.each(this.json_data.categories,function(b,c){a[this.pos]={first_level:this.title,desc:this.desc}}),a},getCategory:function(a){var b={};return $.each(this.json_data.categories,function(c,d){this.title===a&&(b={first_level:this.title,desc:this.desc,pos:this.pos,link:this.link,icon:this.icon})}),b},getMetadataById:function(a){return this.getStreamById(a).metadata[0]},getTitles:function(){var a=[];return $.each(this.json_data,function(b){a.push({first_level:this.metadata[0].title})}),removeDuplicates(a)},getAuthors:function(){var a=[];return $.each(this.json_data,function(b){a.push({first_level:this.metadata[0].author})}),removeDuplicates(a)},getStreamsOfSameAuthor:function(a){var b=this.getMetadataById(a).author,c=[];return $.each(this.json_data,function(d,e){e.metadata[0].author===b&&e.id!=a&&c.push(e.id)}),c},getTagsById:function(a){return void 0===this.json_data.tags?{}:this.getStreamById(a).tags},getCommentsById:function(a){return null===this.getStreamById(a).comments?{}:this.getStreamById(a).comments},getTagList:function(){var a=[];return $.each(this.json_data,function(b){$.each(this.tags,function(b){a.push({first_level:this.tagname})})}),this.removeDuplicates(a).sort()},getTagTaxonomie:function(){var a=[];return $.each(this.json_data._taxonomy,function(b,c){a.push({first_level:this.id,second_level:this.sub})}),a},getStreamsWithSameTag:function(a){var b=this,c=[],d=this.getStreamById(a).tags;return $.each(d,function(a,d){$.each(b.json_data,function(a,b){$.each(b.tags,function(a,e){this.tagname===d.tagname&&c.push(b.id)})})}),c},getRandomStreams:function(a){var b=this,c=[];return $.each(b.json_data,function(a,b){c.push(b.id)}),c},getLinkTargetsById:function(a){var b=[];return $.each(this.getStreamById(a).hyperlinks,function(a){b.push(this.target)}),b},getLinkSourcesById:function(a){var b=[];return $.each(this.json_data,function(c,d){$.each(d.hyperlinks,function(c,e){this.target===a&&b.push(d.id)})}),b},getLinksById:function(a){return this.getStreamById(a).hyperlinks},getAssessmentFillInById:function(a){return this.getStreamById(a).assessmentfillin},getAssessmentWritingById:function(a){return this.getStreamById(a).assessmentwriting},getAssessmentById:function(a){return void 0===this.json_data.assessment?{}:this.json_data.assessment},getAnalysisById:function(a){return null===this.getStreamById(a).assessmentanalysis?{}:this.getStreamById(a).assessmentanalysis},getTocById:function(a){return void 0===this.json_data.toc?{}:this.getStreamById(a).toc},getHighlightById:function(a){return void 0===this.json_data.highlight?{}:this.getStreamById(a).highlight},getSlidesById:function(a){return this.getStreamById(a).slides},hasSlides:function(a){return void 0!==this.getStreamById(a).slides&&this.getStreamById(a).slides.length>0},getUserById:function(a){var b={};return $.each(this.json_user_data,function(c,d){Number(d.id)===Number(a)&&(b=d)}),b},getGroupById:function(a){var b={};return $.each(this.json_group_data,function(c,d){Number(d.id)===Number(a)&&(b=d)}),b},getUserByGroupId:function(a,b){var c=[];return $.each(this.json_user_data,function(d,e){e.groups[b]===a&&c.push(e)}),c},getVideoById:function(a){var b=$("<div></div>").attr("type","video").attr("starttime",0).attr("duration",7).attr("id","myvideo").text(this.getStreamById(a).video);return b}});var Parser=$.inherit({__constructor:function(a,b){this.selector=a,this.type=b},vid_arr:[],selector:"",run:function(){switch(this.type){case"wiki":return this.parseWiki();case"html":return this.parseHtml()}},parseWiki:function(){var a=this,b=-1;return $(this.selector).val($(this.selector).val().replace(/\<p\>/,"")),$($(this.selector+" > p").text().split(/\n/)).each(function(c,d){"[[Video:"===d.substr(0,8)||"[[video:"===d.substr(0,8)?(b++,a.vid_arr[b]=a.parseWikiVideo(d)):"[["===d.substr(0,2)&&a.vid_arr[b].annotation.push(a.parseWikiHyperlink(d))}),this.vid_arr},parseHtml:function(){var a=this,b=-1,c=[],d={},e=0;return $("div"+this.selector+" div").each(function(f,g){if(e=new Date,d={},d.author=void 0===$(this).attr("author")?"":$(this).attr("author"),d.date=void 0===$(this).attr("date")?e.getTime():$(this).attr("date"),d.type=void 0===$(this).attr("type")?"none":$(this).attr("type"),"video"===$(this).attr("type"))c={},c.id=$(this).attr("id"),c.url=$(this).text(),c.seek=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),c.duration=void 0===$(this).attr("duration")?0:$(this).attr("duration"),c.annotation=[],b++,a.vid_arr[b]=c;else if("hyperlinks"===$(this).attr("type")){d.title=$(this).text(),d.description=$(this).attr("description"),d.target=$(this).attr("target"),d.linktype="standard",d.x=$(this).attr("posx"),d.y=$(this).attr("posy"),d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?0:$(this).attr("duration"),d.seek=$(this).attr("seek"),d.duration2=$(this).attr("duration2");var h=/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi,i=new RegExp(h);d.target.match(i)&&(d.linktype="external"),a.vid_arr[b].annotation.push(d)}else"cycle"===$(this).attr("type")?(d.title=$(this).text(),d.target=$(this).attr("target"),d.description=$(this).attr("description"),d.linktype="cycle",d.x=$(this).attr("posx"),d.y=$(this).attr("posy"),d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?0:$(this).attr("duration"),d.seek=$(this).attr("seek"),d.duration=$(this).attr("duration2"),a.vid_arr[b].annotation.push(d)):"syncMedia"===$(this).attr("type")?(d.title=$(this).text(),d.target=$(this).attr("path"),d.linktype="",d.x=0,d.y=0,d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?0:$(this).attr("duration"),a.vid_arr[b].annotation.push(d)):"map"===$(this).attr("type")?(d.title="",d.target=$(this).text(),d.linktype="",d.type="map",d.x=0,d.y=0,d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?0:$(this).attr("duration"),a.vid_arr[b].annotation.push(d)):"toc"===$(this).attr("type")?(d.title=$(this).text(),d.target=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.linktype="",d.note=$(this).attr("note"),d.x=0,d.y=0,d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=1,a.vid_arr[b].annotation.push(d)):"tags"===$(this).attr("type")?(d.title=$(this).text(),d.target=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.x=$(this).attr("posx"),d.y=$(this).attr("posy"),d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?0:$(this).attr("duration"),a.vid_arr[b].annotation.push(d)):"highlight"===$(this).attr("type")?(d.title=$(this).text(),d.target=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.linktype="",d.x=$(this).attr("posx"),d.y=$(this).attr("posy"),d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?0:$(this).attr("duration"),a.vid_arr[b].annotation.push(d)):"comments"===$(this).attr("type")?(d.title=$(this).text(),d.target=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.linktype="",d.x=0,d.y=0,d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=1,a.vid_arr[b].annotation.push(d)):"assessmentanalysis"===$(this).attr("type")?(d.title=$(this).text(),d.target=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.linktype="",d.x=$(this).attr("x"),d.y=$(this).attr("y"),d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?1:$(this).attr("duration"),d.marker=$(this).data("marker"),d.markertype=$(this).attr("markertype"),d.markerlabel=$(this).attr("markerlabel"),d.markerdescription=$(this).attr("markerdescription"),d.markerdescription2=$(this).attr("markerdescription2"),d.markerselect_option=$(this).attr("markerselectoption"),d.id=$(this).attr("id"),a.vid_arr[b].annotation.push(d)):"assessment"===$(this).attr("type")?(d.title=$(this).data("task"),d.target=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.linktype="",d.type="assessment",d.x=0,d.y=0,d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=1,a.vid_arr[b].annotation.push(d)):"assessment-fill-in"===$(this).attr("type")?(d.title=$(this).attr("id"),d.target=$(this).text(),d.linktype="standard",d.width=void 0===$(this).attr("width")?100:$(this).attr("width"),d.type="assessment-fill-in",d.x=$(this).attr("posx"),d.y=$(this).attr("posy"),d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?0:$(this).attr("duration"),d.seek=$(this).attr("seek"),d.duration=$(this).attr("duration2"),a.vid_arr[b].annotation.push(d)):"assessment-writing"===$(this).attr("type")&&(d.title=encodeURIComponent($(this).text()),d.target=$(this).text(),d.linktype="standard",d.width=void 0===$(this).attr("width")?100:$(this).attr("width"),d.type="assessment-writing",d.x=$(this).attr("posx"),d.y=$(this).attr("posy"),d.t1=void 0===$(this).attr("starttime")?0:$(this).attr("starttime"),d.t2=void 0===$(this).attr("duration")?0:$(this).attr("duration"),d.seek=$(this).attr("seek"),d.duration=$(this).attr("duration2"),a.vid_arr[b].annotation.push(d))}),a.vid_arr},parseWikiVideo:function(a){var b,c,d,e=[],f="_";a=a.replace(/^\[\[Video:/,"").replace(/\]\]/,"").replace(/\# /," #").replace(/\| /," |").replace(/  /," ");var g=a.split(/ /);return $.each(g,function(a,e){"#"===e.substr(0,1)?c=e.substr(1,e.length):"|"===e.substr(0,1)?d=e.substr(1,e.length):e.match(/(?=.ogg)/)?b=e:e.length>0&&(f=e)}),e.id=f,e.url=b,e.seek=void 0===c?0:c,e.duration=void 0===d?0:d,e.annotation=[],e},parseWikiHyperlink:function(a){var b="",c="",d={};d.type="hyperlinks",d.linktype="standard",b=new RegExp(/^\[\[http:\/\//),a.match(b)?(b=new RegExp(/\[\[http:\/\/[a-z A-Z 0-9 \#\ \_\/:.-]+/),c=b.exec(a).toString().split(" "),d.target=c[0].replace(/^\[\[/,""),d.title=c.length>=2?c.slice(1):c[0].replace(/^[\[\[http:\/\/]/,""),d.title=d.title.toString().replace(/,/g," "),d.linktype="external"):(b=new RegExp(/\[\[[a-z A-Z 0-9 \# \ \_\/\|:.-]+/),c=b.exec(a).toString().split(/\|/),d.target=c[0].replace(/^\[\[/,""),d.title=c.length>=2?c[1]:c[0].replace(/^\[\[/,""));var e=a.split(/\]/);return b=new RegExp(/[\ ]\#[0-9]+/),d.t1=a.match(b)?b.exec(e[1]).toString().replace(/[\#]/,""):0,b=new RegExp(/[\ ]\|[0-9]+/),d.t2=a.match(b)?b.exec(e[1]).toString().replace(/[\|]/,""):1e3,b=new RegExp(/[\ ]+[0-9]{2}(?=\%)/g),c=a.match(b)?a.match(b).toString().split(/,/):[50,50],d.x=c[0]?c[0]:50,d.y=c[1]?c[1]:50,d}}),Video=$.inherit({__constructor:function(a){vi2.observer.player=this,this.options=$.extend(this.options,a),this.spinner=new Spinner(this.spinner_options),this.video=document.getElementById(this.options.selector.replace(/\#/,"")),this.loadUI()},name:"video player",options:{observer:null,selector:"#video1",width:500,height:375,seek:0,videoControlsSelector:".video-controls",thumbnail:"/static/img/placeholder.jpg",defaultVolume:1},video:null,timeline:null,observer:null,url:"",video_container:null,video_wrap:null,play_btn:null,volume_btn:null,volume:null,isMuted:!1,isSequence:!1,seqList:[],seqNum:null,seqLoop:!1,videoIsPlaying:!0,percentLoaded:0,buffclick:0,spinner:!1,spinner_options:{lines:6,length:0,width:20,radius:20,color:"#003366",speed:1,trail:89,shadow:!1,hwaccel:!1,className:"spinner",zIndex:29,top:"auto",left:"auto"},loadVideo:function(a,b){var c=this;this.url=a,this.seek=void 0===b?0:b;var d=$("<video></video>").attr("controls",!1).attr("autobuffer",!0).attr("preload","metadata").attr("id","video1").css({width:"75vw"}).text("Your Browser does not support either this video format or videos at all");$("#seq").html(d),this.video=document.getElementById(this.options.selector.replace(/\#/,"")),this.videoIsPlaying&&$(vi2.observer.player).trigger("player.play",[]),this.video.pause(),this.startSpinning();var e=this.detectVideoSupport();this.video=$.extend(this.video,{loop:!1,preload:"metadata",autoplay:this.videoIsPlaying,controls:!1,onerror:function(a){c.errorHandling(a)}}),this.timeline=new Vi2.AnnotatedTimeline(this.video,{},this.seek),this.logger();var f=new Vi2.PlaybackSpeed;vi2.observer.addWidget(f);var g=new Vi2.SkipBack;vi2.observer.addWidget(g),this.play_btn=$(".vi2-video-play-pause"),this.video.addEventListener("play",function(a){vi2.observer.clock.startClock(),c.play_btn.find(".glyphicon-pause").show(),c.play_btn.find(".glyphicon-play").hide()}),this.video.addEventListener("pause",function(a){vi2.observer.clock.stopClock(),$("header").show(),c.play_btn.find(".glyphicon-pause").hide(),c.play_btn.find(".glyphicon-play").show()}),this.video.addEventListener("abort",function(a){vi2.observer.clock.stopClock(),$("header").show(),c.play_btn.find(".glyphicon-pause").hide(),c.play_btn.find(".glyphicon-play").show()}),this.video.addEventListener("readystate",function(a){c.readyStateHandler(a)}),this.video.addEventListener("timeupdate",function(a){c.timeUpdateHandler(a)}),this.video.addEventListener("ended",function(a){c.endedHandler(a)},!1);var h=new Date;$(vi2.observer).trigger("stream.loaded",{stream:vi2.observer.current_stream,playback_time:b,time:h.getTime()}),void 0!==a&&$(this.video).html(this.createSource(a,e),this.video.firstChild)},detectVideoSupport:function(){var a=document.createElement("video");return""!==a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')?(vi2.observer.log({context:"player",action:"video-support-mp4",values:["1"]}),"video/mp4"):""!==a.canPlayType('video/webm; codecs="vp8, vorbis"')?(vi2.observer.log({context:"player",action:"video-support-webm",values:["1"]}),"video/webm"):""!==a.canPlayType('video/ogg; codecs="theora, vorbis"')?(vi2.observer.log({context:"player",action:"video-support-ogv",values:["1"]}),"video/ogv"):(vi2.observer.log({context:"player",action:"video-support-none",values:["1"]}),$("#page").html('<h3>We appologize that video application is currently not supported by your browser.</h3>The provided video material can be played on Mozilla Firefox, Google Chrome and Opera. If you prefer Internet Explorer 9 you need to install a <a href="https://tools.google.com/dlpage/webmmf">webm video extension</a> provided by Google. In the near future we are going to server further video formats which will be supported by all major browsers.<br /><br /> Thank you for your understanding.'),"")},detectBrowser:function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\b(OPR|Edge)\/(\d+)/),null!=a)?a.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c[0])},loadSequence:function(a,b,c){this.seqList=a,this.seek=c,this.isSequence=!0,void 0===b?this.seqNum=0:this.seqNum=b,this.loadVideo(this.seqList[this.seqNum].url,this.seek)},createSource:function(a,b){var c=".mp4",d=document.createElement("source");return"Firefox"===this.detectBrowser()?(c=".webm",b="video/webm"):"Chrome"===this.detectBrowser()&&(c=".webm",b="video/webm"),d.src=a.replace(".mp4",c)+"?foo="+(new Date).getTime(),d.type=b,d},loadUI:function(){function a(){c=null,document.body.style.cursor="none",d=!1,$(b.options.videoControlsSelector).removeClass("open-controls")}var b=this;this.createPlaybackControl(),this.createVolumeControl(),this.createVideoHiding(),$(b.options.videoControlsSelector).addClass("open-controls");var c=null,d=!0;document.getElementById("video1");document.onmousemove=function(){c&&window.clearTimeout(c),d||(document.body.style.cursor="default",d=!0,$(b.options.videoControlsSelector).addClass("open-controls")),c=window.setTimeout(a,1e3)},$("body").unbind("keydown").bind("keydown",function(a){})},createPlaybackControl:function(){var a=this;this.play_btn=$(".vi2-video-play-pause"),this.play_btn.bind("click",function(){a.play()}),$(this.play_btn).bind("play",function(a){vi2.observer.play(),$(".screen").remove()}),$(this.play_btn).bind("pause",function(a){vi2.observer.pause()}),$(vi2.observer.player).bind("player.play",function(a,b,c){}),$(vi2.observer.player).bind("player.pause",function(a,b,c){})},createVolumeControl:function(){var a=this;this.volume=$(".vi2-volume-slider",this.video_container),this.volume_btn=$(".vi2-volume-button",this.video_container),$(this.volume).slider({orientation:"horizontal",range:"min",max:1,step:.05,animate:!1,value:a.options.defaultVolume,slide:function(b,c){c.value>0&&c.value<.5?(a.isMuted=!1,a.volume_btn.addClass("glyphicon-volume-down"),a.volume_btn.removeClass("glyphicon-volume-up"),a.volume_btn.removeClass("glyphicon-volume-off")):c.value>=.5?(a.isMuted=!1,a.volume_btn.removeClass("glyphicon-volume-down"),a.volume_btn.addClass("glyphicon-volume-up"),a.volume_btn.removeClass("glyphicon-volume-off")):(a.isMuted=!0,a.volume_btn.removeClass("glyphicon-volume-down"),a.volume_btn.removeClass("glyphicon-volume-up"),a.volume_btn.addClass("glyphicon-volume-off"))},change:function(b,c){a.video.volume=c.value,c.value>0&&c.value<.5?(a.isMuted=!1,a.volume_btn.addClass("glyphicon-volume-down"),a.volume_btn.removeClass("glyphicon-volume-up"),a.volume_btn.removeClass("glyphicon-volume-off")):c.value>=.5?(a.isMuted=!1,a.volume_btn.removeClass("glyphicon-volume-down"),a.volume_btn.addClass("glyphicon-volume-up"),a.volume_btn.removeClass("glyphicon-volume-off")):(a.isMuted=!0,a.volume_btn.removeClass("glyphicon-volume-down"),a.volume_btn.removeClass("glyphicon-volume-up"),a.volume_btn.addClass("glyphicon-volume-off"))}}),this.volume_btn.bind("click",function(b){a.muteVolume()}),0===this.volume.slider("value")?(this.isMuted=!0,this.volume_btn.addClass("glyphicon glyphicon-volume-off")):this.volume_btn.addClass("glyphicon glyphicon-volume-up")},getVolume:function(){return this.volume.slider("value")},setVolume:function(a){this.volume.slider("value",a),vi2.observer.log({context:"player",action:"set-volume",values:[a]})},increaseVolume:function(){$(this.volume).slider("value",$(this.volume).slider("value")+.05)},decreaseVolume:function(){$(this.volume).slider("value",$(this.volume).slider("value")-.05)},tmp_volume:0,muteVolume:function(){this.isMuted?(this.setVolume(tmp_volume),this.isMuted=!1):(tmp_volume=this.volume.slider("value"),this.setVolume(0),this.isMuted=!0)},createVideoHiding:function(){return},startSpinning:function(){this.spinner.spin(document.getElementById("overlay")),$(".spinner").css("top","200px")},stopSpinning:function(){this.spinner.stop()},readyStateHandler:function(a){vi2.observer.updateVideo(this.seqList[this.seqNum].id,this.seqNum)},timeUpdateHandler:function(a){2===this.video.readyState?this.startSpinning():4===this.video.readyState&&this.stopSpinning()},endedHandler:function(a){vi2.observer.log({context:"player",action:"video-ended",values:[this.url]}),vi2.observer.ended(),this.video.removeEventListener("ended",arguments.callee,!1),this.isSequence&&(this.seqNum+1<this.seqList.length||this.seqLoop)?(this.seqNum=(this.seqNum+1)%this.seqList.length,this.loadVideo(this.seqList[this.seqNum].url)):$(vi2.observer.player).trigger("video.end",null)},keyboardCommandHandler:function(a){switch(a.preventDefault(),this.video.focus(),a.which){case 32:this.play();break;case 189:vi2.observer.getWidget("playbackSpeed").decreaseSpeed();break;case 187:vi2.observer.getWidget("playbackSpeed").increaseSpeed();break;case 38:this.increaseVolume();break;case 40:this.decreaseVolume();break;case 77:this.muteVolume();break;case 39:vi2.observer.widget_list.toc.nextElement();break;case 37:vi2.observer.widget_list.toc.previousElement();break;case 34:vi2.observer.player.play();break;case 33:vi2.observer.widget_list.toc.previousElement()}this.video.focus()},play:function(){this.video.paused===!1?(this.video.pause(),this.isPlaying(!1),$(vi2.observer.player).trigger("player.pause",[]),vi2.observer.clock.stopClock(),vi2.observer.log({context:"player",action:"pause-click",values:["1"]})):(this.video.play(),this.isPlaying(!0),$(vi2.observer.player).trigger("player.play",[]),vi2.observer.clock.startClock(),vi2.observer.log({context:"player",action:"play-click",values:["1"]}))},pause:function(){this.video.pause(),this.isPlaying(!1),$(vi2.observer.player).bind("player.pause"),vi2.observer.log({context:"player",action:"pause2-click",values:["1"]})},isPlaying:function(a){return void 0===a?this.videoIsPlaying:void(this.videoIsPlaying=a)},duration:function(){return this.video.duration},currentTime:function(a){return void 0===a?this.video.currentTime:($(this.video).trigger("play"),this.video.currentTime=a,this.play(),void 0)},width:function(a){if(null===a)return $("#video1").width()},height:function(a){if(null===a)return $("#video1").height()},errorHandling:function(a){},logger:function(){function a(){var a;a=Math.round(e.currentTime())/f>>0,a!=g&&(vi2.observer.log({context:"player",action:"playback",values:[a]}),g=a)}function b(){d&&(d=clearInterval(d)),d=setInterval(a,1e3*f),setTimeout(a,100)}function c(){d=clearInterval(d),a()}var d,e=this,f=5,g=-1;this.video.addEventListener("play",function(a){b()}),this.video.addEventListener("pause",function(a){c()}),this.video.addEventListener("abort",function(a){c()}),this.video.addEventListener("timeupdate",function(a){}),this.video.addEventListener("ended",function(a){c()},!1)}});Vi2.AnnotatedTimeline=$.inherit({__constructor:function(a,b,c){this.video=a,this.options=$.extend(this.options,b),this.seek=void 0===c?0:c,this.init()},name:"annotated timeline",type:"core",options:{timelineSelector:".vi2-timeline-main",hasPreview:!1,hasSlidePreview:!1,previewPath:"/static/img/video-stills/theresienstadt/still-image-",hasMarker:!0,path:"/"},video:null,seek:0,seeksliding:!1,video_seek:null,video_loading_progress:null,video_timer:null,interval:0,percentLoaded:0,video_container:null,cursorX:0,init:function(a){var b=this;this.video_seek=$(this.options.timelineSelector),this.video_loading_progress=$(".vi2-timeline-progress"),this.video_timer=$(".vi2-video-timer"),this.options.hasPreview,this.options.hasSlidePreview;var c=0,d=0;this.video.onloadstart=function(a){c=Date.now()},this.video.ondurationchange=function(){d=Date.now()-c,b.handleDurationChange()},this.video.onloadedmetadata=function(a){},this.video.onloadeddata=function(a){vi2.observer.log({context:"player",action:"video-loading-time",values:[d,Date.now()-c]})},this.video.onprogress=function(a){},this.video.oncanplay=function(a){},this.video.oncanplaythrough=function(a){},this.video.addEventListener("timeupdate",function(a){b.handleTimeupdate(a)})},createTimelineControl:function(){var a=this;this.video_seek.slider({value:0,step:.01,orientation:"horizontal",range:"min",max:vi2.observer.player.duration(),animate:!1,slide:function(b,c){a.seeksliding=!0},start:function(b,c){vi2.observer.log({context:"player",action:"seek-start",values:[c.value]}),a.buffclick++,a.seeksliding=!0},stop:function(b,c){vi2.observer.log({context:"player",action:"seek-stop",values:[c.value]}),a.seeksliding=!1,vi2.observer.player.currentTime(parseFloat(Math.ceil(c.value)))}})},createTimelineVideoPreview:function(){var a=this,b=$(this.options.timelineSelector).width(),c=($(this.options.timelineSelector).offset().left,1),d=null,e=new Image;e.id="videopreview";var f=$("<div></div>").addClass("vi2-timeline-preview").html(e).appendTo(a.options.timelineSelector),g=function(e){$(f).css({left:e.pageX-100}),c=Math.round(e.pageX/b*vi2.observer.player.duration())-20,d=new Image,img_selector=document.getElementById("videopreview"),listener=function(a){img_selector.src=d.src},d.removeEventListener("load",listener,!1),d.addEventListener("load",listener,!1),d.src=a.options.previewPath+""+c+".jpg",d.onerror=function(){this.style.display="none"}},h=document.getElementsByClassName("vi2-timeline-main");h[0].removeEventListener("mousemove",g),h[0].addEventListener("mousemove",g)},createTimelineSlidePreview:function(){var a=this,b=$(this.options.timelineSelector).width(),c=($(this.options.timelineSelector).offset().left,1),d=null,e=$("<div></div>").addClass("vi2-timeline-preview").appendTo(this.options.timelineSelector),f=document.getElementsByClassName("vi2-timeline-main");f[0].addEventListener("mousemove",function(f){$(e).css({left:f.pageX-100}),c=Math.floor(vi2.observer.player.duration()/b*Math.floor(f.pageX)).toString(),d=new Image,d.src=a.options.previewPath+""+c+".png",listener=function(a){$(e).html(d)},d.removeEventListener("load",listener,!0),d.addEventListener("load",listener,!0)},!1)},addTimelineMarkers:function(a,b,c){var d=this;void 0===c&&(c=this.options.timelineSelector),this.options[a]={markerHasTooltip:!0,markerIsClickable:!0};var e=$(c);$("."+a+"-timeline-marker").each(function(a,b){$(b).remove()}),$.each(b,function(b,f){var g=f.occ[0]/vi2.observer.player.duration();if(g*=$(c).width(),!(isNaN(g)||g>$(c).width())){var h=$("<a></a>").addClass(a+"-timeline-marker ttoc").attr("style","left:"+g+"px;");d.options[a].markerHasTooltip&&h.attr("title",f.name).attr("data-toggle","tooltip"),d.options[a].markerIsClickable&&h.bind("click",function(b){vi2.observer.player.currentTime(f.occ[0]),vi2.observer.log({context:a,action:"timeline-link-click",values:[f.name,f.author,f.occ[0]]})}),e.append(h)}})},handleDurationChange:function(a){this.createTimelineControl(),vi2.observer.player.currentTime(this.seek),$(vi2.observer).trigger("player.ready",[vi2.observer.player.seqList[vi2.observer.player.seqNum].id,vi2.observer.player.seqNum])},handleProgress:function(a){var b=this.video;percent=null,b&&b.buffered&&b.buffered.length>0&&b.buffered.end&&b.duration?percent=b.buffered.end(0)/b.duration:b&&void 0!==b.bytesTotal&&b.bytesTotal>0&&void 0!==b.bufferedBytes?percent=b.bufferedBytes/b.bytesTotal:a&&a.lengthComputable&&0!==a.total&&(percent=a.loaded/a.total),null!==percent&&(this.percentLoaded=percent,percent=Math.min(1,Math.max(0,percent)),this.video_loading_progress&&this.video_seek&&this.video_loading_progress.width(this.video_seek.width()*percent))},handleTimeupdate:function(a){!this.seeksliding&void 0!==vi2.observer.player&&this.video_seek.slider("value",vi2.observer.player.currentTime())},pixelInTime:function(){}}),Vi2.Clock=$.inherit({
__constructor:function(a){a>20&&a<5e3?this.clockInterval=a:console.log("Error")},name:"clock",clockInterval:500,isRunning:!1,interval:-1,annotations:[],hooks:[],isHook:function(a){return null!==this.hooks[a]},addHook:function(a,b){return this.hooks[a]=b,!0},addAnnotation:function(a){this.isHook(a.type)&&this.annotations.push({active:!1,author:a.author,width:a.width,content:{title:a.title,target:a.target,description:a.description,note:a.note},linktype:a.linktype,type:a.type,displayPosition:{x:a.x,y:a.y,t1:a.t1,t2:a.t2},seek:a.seek,duration:a.duration,data:a})},checkAnnotation:function(){for(var a=this.parseTime(vi2.observer.player.currentTime()),b=this.annotations.length,c=0;c<b;c++){var d=this.annotations[c];a>=d.displayPosition.t1&&a<Number(d.displayPosition.t1)+Number(d.displayPosition.t2)?d.active||(d.active=!0,$(vi2.observer.player).trigger("annotation.begin."+d.type,[c,d])):(d.active=!1,$(vi2.observer.player).trigger("annotation.end."+d.type,[c,d]))}},prepAnno:[],buildAnnotationIndex:function(){for(var a=[],b=0;b<1e3;b++)a[b]=[];$.each(this.annotations,function(b,c){var d=c.displayPosition.t1<1?0:Math.ceil(c.displayPosition.t1/100);a[d].push(c)}),this.prepAnno=a},checkAnnotation_new:function(){var a=this,b=this.parseTime(vi2.observer.player.currentTime()),c=vi2.observer.player.currentTime()<1?0:Math.ceil(b/100);$.each(a.prepAnno[c],function(a,c){b>=c.displayPosition.t1&&b<Number(c.displayPosition.t1)+Number(c.displayPosition.t2)?c.active||(c.active=!0,$(vi2.observer.player).trigger("annotation.begin."+c.type,[a,c])):(c.active=!1,$(vi2.observer.player).trigger("annotation.end."+c.type,[a]))})},startClock:function(){if(!this.isRunning){var a=this;this.isRunning=!0,this.interval=setInterval(function(){a.checkAnnotation()},this.clockInterval)}},stopClock:function(){clearInterval(this.interval),clearInterval(this.interval),this.isRunning=!1},reset:function(){$("#overlay").html(""),this.annotations=[]},parseTime:function(a){return a}}),Vi2.Metadata=$.inherit({__constructor:function(a){this.metadata=vi2.db.getMetadataById(vi2.observer.current_stream),this.options=$.extend(this.options,a),this.update()},options:{selector:".metadata",requiresMetatags:!0,requiresDisplay:!0},update:function(){this.options.requiresDisplay&&this.displayMetadata(),this.options.requiresMetatags&&this.buildMetaTags()},displayMetadata:function(){},buildMetaTags:function(){$("head meta").each(function(a,b){$(b).remove()}),$("head").prepend('<meta content="text/html;charset=utf-8" http-equiv="Content-Type">').prepend('<meta content="utf-8" http-equiv="encoding">').prepend('<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>').prepend('<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />').prepend('<meta itemprop="duration" content="'+this.metadata.length+'" />').prepend('<meta itemprop="height" content="'+vi2.observer.player.height()+'" />').prepend('<meta itemprop="width" content="'+vi2.observer.player.width()+'" />').prepend('<meta itemprop="uploadDate" content="'+this.metadata.date+'" />').prepend('<meta itemprop="contentURL" content="'+vi2.db.getStreamById(vi2.observer.current_stream).video+'" />')}}),Vi2.Annotation=$.inherit({__constructor:function(a){this.options=a},name:"annotation",type:"annotation",options:{},init:function(a){},appendToDOM:function(a){},begin:function(a,b,c){},end:function(a,b){},animation:function(a,b){$(a).animate({left:100},{duration:1e3})},validateAnnotationForm:function(a,b){var c=0,d=0,e="";return $(a).find("input[type=text]").each(function(a,b){""===$(b).val()?($(b).addClass("validation-conflict"),d=!0):$(b).removeClass("validation-conflict")}),d&&(e+="\n Versehen Sie bitte die/das Textfeld/er mit einem Text."),$(a).find("textarea").each(function(a,b){String($(b).val()).length<2?($(b).addClass("validation-conflict"),c=!0):$(b).removeClass("validation-conflict")}),c&&(e+="\n Definieren Sie bitte einen Text für das Textfeld."),$(a).find("input[type=checkbox]").length>0&&0===$(a).find("input:checked").length?($(a).find("input[type=checkbox]").addClass("validation-conflict"),e=NaN):$(a).find("input[type=checkbox]").removeClass("validation-conflict"),0===String(e).length?e:(console.log("Validation Error:"+e),e)},formatTime:function(a,b){b=b?b:"";var c=Math.round(a),d=Math.floor(c/60);return d=d>=10?d:"0"+d,c=Math.floor(c%60),c=c>=10?c:"0"+c,d+b+c}}),Vi2.VideoManager=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a)},name:"video-manager",type:"collection",content_selector:"#content",options:{selector:"#seq"},viewing_history:[],init:function(){var a=this;Sammy(this.options.selector,function(){this.get("#!/video/:stream/:time",function(){a.handleNewStream(this.params)}),this.get("#!/video/:stream",function(){a.handleNewStream(this.params)}),this.get("#!/videos/all",function(){a.handleAllStreams()}),this.get("#!/tags/:tag",function(){a.handleTags(this.params)}),this.get("#!/category/:category",function(){a.handleCategory(this.params)})}).run()},addRoute:function(a,b,c){Sammy(this.options.selector,function(){this.get("#!"+a,function(){b[c]()})}).run()},render:function(a,b){return new EJS({url:vi2.templatePath+""+a}).render(b)},handleTags:function(a){for(var b=a.tag.split(/,/),c="",d=[],e=vi2.db.getInvertedTagIndex(),f=0;f<b.length;f++)void 0!==e[b[f]]&&(c+=e[b[f]].toString()+",");var g=[];g=removeDuplicates(c.split(/,/));for(var h=0;h<g.length;h++)if(""!==g[h]){var i=vi2.db.getStreamById(g[h]);d.push(i)}var j=this.render("vi2.video-manager.ejs",{title:"Tags: "+b.toString(),items:d});$(this.options.selector).html(j)},handleCategory:function(a){var b=a.category,c=vi2.db.getStreamsByCategory(b),d=this.render("vi2.video-manager.ejs",{title:"Category: "+b,items:c});$(this.options.selector).html(d)},handleAllStreams:function(a){var b=vi2.db.getAllStreams(),c=this.render("vi2.video-manager.ejs",{title:"Category: "+category,items:b});$(this.options.selector).html(c)},handleNewStream:function(a){var b=this,c=void 0===a.time?0:a.time.split(/:/)[1];a.stream!=vi2.observer.current_stream?($(vi2.dom).empty(),vi2.observer.setCurrentStream(a.stream,c),vi2.observer.player.play(),b.loadWidgets()):vi2.observer.player.currentTime(c)},loadWidgets:function(){var a=new Vi2.TableOfContents({hasTimelineMarker:!0,hasMenu:!0,menuSelector:".toc"}),b=new Vi2.SyncronizeMedia({selector:".syncMedia",hasTimelineMarker:!0,hasMenu:!0,menuSelector:".toc"}),c=new Vi2.RelatedVideos({resultSelector:".related-videos",criteria:[{criterion:"random-destructor",weight:.1},{criterion:"same-author",weight:.8},{criterion:"same-tags",weight:.6},{criterion:"incomming-links",weight:.5},{criterion:"outgoing-links",weight:.5}]});new Vi2.Search({resultSelector:".search-results",limit:25});vi2.observer.addWidget(a),vi2.observer.addWidget(b),vi2.observer.addWidget(c)},listAllItems:function(){var a=$("#item_template").val();$.each(this.getCategoryTaxonomie(),function(b,c){$(_this.content_selector).append($("<h2></h2>").addClass("cat"+b).text(c)).append("<br>"),$.each(_this.json_data.stream,function(b,d){if(d.metadata[0].category==c){$("<div></div>").setTemplate(a).processTemplate(d).appendTo($(_this.content_selector))}})})}}),jQuery.fn.dropdown=function(a){var b=$(this).find("h4"),c=$(this).html();$(this).toggle(function(){$(this).html(b.wrapInner("<h4></h4>").html())},function(){$(this).html(c).find("h4").attr("style","background-image:url(images/arrow_d.png); display:inline;")}).click()},jQuery.fn.hidetext=function(a){var b=$(this).text(),c=$(this).text(b.substr(0,250)+" ").append($("<span>more</span>"));return c},jQuery.fn.round=function(a){return a||(a=0),Math.round(this*Math.pow(10,a))/Math.pow(10,a)},Object.size=function(a){var b=0,c={};for(c in a)a.hasOwnProperty(c)&&b++;return b},Vi2.Utils=$.inherit({__constructor:function(a){},name:"utils",seconds2decimal:function(a){d=Number(a);var b=Math.floor(d/3600),c=Math.floor(d%3600/60),e=Math.floor(d%3600%60);return(b>0?b+":":"")+(c>0?(b>0&&c<10?"0":"")+c+":":"00:")+(e<10?"0":"")+e},deci2seconds:function(a){if(Number(a)<0||void 0===a)return 0;var b=a.split(":");return 3600*Number(b[0])+60*Number(b[1])+Number(b[2])}}),Vi2.Maintain=$.inherit({__constructor:function(){},validateTags:function(){var a=[];$.each(this.json_data._taxonomy,function(b,c){$.each(c.sub,function(b,c){a.push(c)})});var b=[];$.each(this.json_data._stream,function(a,c){$.each(this.tags,function(a,c){b.push(c.tagname)})}),$.each(a,function(a,c){$.inArray(c,b)===-1&&$("#debug").append(c+", ")})},validateTags2:function(){var a=[];$.each(this.json_data._taxonomy,function(b,c){$.each(c.sub,function(b,c){a.push(c)}),a.push(c.id)}),$.each(this.json_data._stream,function(b,c){$("#debug").append("Not found in "+c.id+": "),$.each(this.tags,function(b,c){$.inArray(c.tagname,a)===-1&&$("#debug").append(c.tagname+", ")}),$("#debug").append("<br/>")})},validateLinks:function(){$.each(this.json_data._stream,function(a,b){$("#debug").append("["+b.id+"] "+b.metadata[0].title+" ("+b.metadata[0].author+"):<br/>"),$.each(this.links,function(a,b){$("#debug").append('"'+b.id+'" @ '+b.start+" => "+b.text+"<br/>")}),$("#debug").append("<br/>")})},generateButter:function(a){var b=vi2.db.getStreamById(a).video;b=b.replace("http://141.46.8.101/beta/e2script/","http://127.0.0.1:3033/static/videos/");var c='{"template":"basic","title":"'+a+'","guid":"AA41AB3B-D145-477E-A264-3B42701F1E85", "project": {"targets":[{"id":0,"name":"Area1"},{"id":1,"name":"pop-container"}],"media":[ {"id":"Media0","name":"Media01327337635028","url":"'+b+'","target":"main","duration":4829.205,"tracks":[',d="",e="",f="",g="";$.each(vi2.db.getStreamById(a,!0).slides,function(a,b){a%2===0?f+='{"id":"TrackEvent'+a+'","type":"image","popcornOptions": {"start":'+this.starttime+',"end":'+(Number(this.starttime)+Number(this.duration))+',"href":"","src":"http://127.0.0.1:3033/static/slides/'+this.img+'","text":"","target":"Area1"}, "track":"Track1327337639244","name":"Track1327337639'+Math.ceil(1e3*Math.random())+'"},':g+='{"id":"TrackEvent'+a+'","type":"image","popcornOptions": {"start":'+this.starttime+',"end":'+(Number(this.starttime)+Number(this.duration))+',"href":"","src":"http://127.0.0.1:3033/static/slides/'+this.img+'","text":"","target":"Area1"}, "track":"Track1327337639255","name":"Track1327337639'+Math.ceil(1e3*Math.random())+'"},'}),d='{"name":"Track1327337639244","id":"Track0", "trackEvents":['+f.substr(0,f.length-1)+"]},",e='{"name":"Track1327337639255","id":"Track1", "trackEvents":['+g.substr(0,g.length-1)+"]}",c+=d+e+"]}]}}",console.log("-------------------------------"),console.log(c),console.log("-------------------------------")},foo:function(){for(var a=[{id:"TrackEvent14",type:"image",popcornOptions:{start:54.7,end:93.6,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-1.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639593"},{id:"TrackEvent15",type:"image",popcornOptions:{start:125,end:289.3,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-3.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639694"},{id:"TrackEvent16",type:"image",popcornOptions:{start:668.1212462686567,end:945.8177313432838,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-5.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track132733763969"},{id:"TrackEvent17",type:"image",popcornOptions:{start:1121.7838208955225,end:1314.2467313432835,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-7.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639407"},{id:"TrackEvent18",type:"image",popcornOptions:{start:1366.4866641791045,end:1399.4803059701492,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-9.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track132733763919"},{id:"TrackEvent19",type:"image",popcornOptions:{start:1422.850802238806,end:1481.9644104477613,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-11.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639276"},{id:"TrackEvent20",type:"image",popcornOptions:{start:1744.5388097014925,end:1884.761787313433,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-13.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track132733763973"},{id:"TrackEvent21",type:"image",popcornOptions:{start:1916.380694029851,end:1997.490063432836,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-15.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639397"},{id:"TrackEvent22",type:"image",popcornOptions:{start:2084.0983731343285,end:2195.4519141791047,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-17.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639135"},{id:"TrackEvent23",type:"image",popcornOptions:{start:2354.921182835821,end:2386.540089552239,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-19.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639731"},{id:"TrackEvent24",type:"image",popcornOptions:{start:2510.266246268657,end:2536.3862126865674,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-21.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639377"},{id:"TrackEvent25",type:"image",popcornOptions:{start:2565.2556492537315,end:2603.748231343284,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-23.jpg",text:"",target:"Area1"},track:"Track1327337639255",name:"Track1327337639206"},{id:"TrackEvent0",type:"image",popcornOptions:{start:0,end:54.7,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-0.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639838"},{id:"TrackEvent1",type:"image",popcornOptions:{start:93.6,end:125,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-2.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639534"},{id:"TrackEvent2",type:"image",popcornOptions:{start:288.69436567164183,end:668.1212462686567,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-4.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639491"},{id:"TrackEvent3",type:"image",popcornOptions:{start:944.4429962686568,end:1121.7838208955225,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-6.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639782"},{id:"TrackEvent4",type:"image",popcornOptions:{start:1311.49726119403,end:1366.4866641791045,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-8.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639702"},{id:"TrackEvent5",type:"image",popcornOptions:{start:1399.4803059701492,end:1422.850802238806,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-10.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639931"},{id:"TrackEvent6",type:"image",popcornOptions:{start:1479.2149402985076,end:1743.1640746268658,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-12.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639523"},{id:"TrackEvent7",type:"image",popcornOptions:{start:1879.2628470149255,end:1916.380694029851,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-14.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639797"},{id:"TrackEvent8",type:"image",popcornOptions:{start:2000.2395335820895,end:2084.0983731343285,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-16.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639833"},{id:"TrackEvent9",type:"image",popcornOptions:{start:2191.327708955224,end:2353.546447761194,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-18.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639154"},{id:"TrackEvent10",type:"image",popcornOptions:{start:2385.165354477612,end:2510.266246268657,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-20.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639866"},{id:"TrackEvent11",type:"image",popcornOptions:{start:2537.760947761194,end:2562.5061791044777,href:"",src:"http://127.0.0.1:3033/static/slides/video5/e2script_5-22.jpg",text:"",target:"Area1"},track:"Track1327337639244",name:"Track1327337639376"}],b="",c=0;c<a.length;c++)b+='{ "id":"slide'+c+'", "type":"seq", "img":"'+a[c].popcornOptions.src.replace("http://127.0.0.1:3033/static/slides/","")+'", "starttime":'+a[c].popcornOptions.start+', "duration":'+(Number(a[c].popcornOptions.end)-Number(a[c].popcornOptions.start))+" },";console.log(b)},json_import:function(){var a=this,b="",c="";$.ajax({type:"POST",dataType:"json",url:"./data_slide_update.json",success:function(d){$.each(d.data,function(d,e){c="",$.each(e.project.media,function(b,d){$.each(d.tracks,function(b,d){$.each(d.trackEvents,function(b,d){"image"===d.type?c+='{ "type":"seq", "starttime":'+d.popcornOptions.start+', "duration":'+(d.popcornOptions.end-d.popcornOptions.start)+', "id":"", "img":"'+String(d.popcornOptions.src).replace("http://elearning.ihi-zittau.de/beta/iwrm/slides/"+e.title+"/","")+'" },':"pop"===d.type&&(c+="#x: "+d.popcornOptions.left+"  #y: "+d.popcornOptions.top+"  #start: "+a.seconds2deci(d.popcornOptions.start)+"  #dur: "+(d.popcornOptions.end-d.popcornOptions.start)+"  #text: "+d.popcornOptions.text+"  #target: "+d.popcornOptions.link,c+="\n")})})}),b+='\n { "id": "'+e.title+'", "slides":['+c.substr(0,c.length-1)+"]},\n"});var e="";e+='{ "_name": "vi2 slides", "_slides": [\n',e+=b.substr(0,b.length-1),e+="\n]}",$("#debug").html(e)},error:function(a,b,c){alert("error at json import "+b)}})},seconds2deci:function(a){var b=new Date(Math.ceil(1e3*a));return b.getHours()-1+":"+b.getMinutes()+":"+b.getSeconds()},validateImages:function(){var a="#!/bin/bash \n";new Image;$.each(this.json_slide_data._slides,function(b,c){var d=c.id;a+="mkdir "+c.id,$.each(c.slides,function(b,e){a+="cp ./"+d+"/"+e.img+" /"+c.id+" ;"})}),$("#debug").html(a)},test:function(){var a="cullmann";if(a){var b='{"template":"basic","title":"'+a+'","guid":"AA41AB3B-D145-477E-A264-3B42701F1E85", "project": {"targets":[{"id":0,"name":"Area1"},{"id":1,"name":"pop-container"}],"media":[ {"id":"Media0","name":"Media01327337635028","url":"http://127.0.0.1:3033/static/videos/iwrm_'+a+'.ogv","target":"main","duration":4829.205,"tracks":[',c="",d="",e="",f="",g="";$.ajax({type:"POST",dataType:"json",url:"http://127.0.0.1:3033/static/data-slides.json",success:function(h){$.each(h._slides,function(b,c){c.id==a&&$.each(c.slides,function(b,c){b%2===0?f+='{"id":"TrackEvent'+b+'","type":"image","popcornOptions": {"start":'+this.starttime+',"end":'+(this.starttime+this.duration)+',"href":"","src":"http://127.0.0.1:3033/static/slides/'+a+"/"+this.img+'","text":"","target":"Area1"}, "track":"Track1327337639244","name":"Track1327337639'+Math.ceil(1e3*Math.random())+'"},':g+='{"id":"TrackEvent'+b+'","type":"image","popcornOptions": {"start":'+this.starttime+',"end":'+(this.starttime+this.duration)+',"href":"","src":"http://127.0.0.1:3033/static/slides/'+a+"/"+this.img+'","text":"","target":"Area1"}, "track":"Track1327337639255","name":"Track1327337639'+Math.ceil(1e3*Math.random())+'"},'})}),c='{"name":"Track1327337639244","id":"Track0", "trackEvents":['+f.substr(0,f.length-1)+"]},",d='{"name":"Track1327337639255","id":"Track1", "trackEvents":['+g.substr(0,g.length-1)+"]}",b+=c+d+e+"]}]}}",$("#debug").html(b)},error:function(a){alert("error at json import")}})}},chord:function(){var a=this,b="",c="";$.ajax({type:"POST",dataType:"json",url:"./data.json",success:function(d){$.each(d._stream,function(d,e){c="",$.each(e.links,function(b,d){var f=String(a.getStreamById(e.id).metadata[0].category).replace(/\ /g,"").replace(/\_/g,"").replace(/\-/g,"").toLowerCase();c+='"flare.'+f+"."+d.text+'.x",'}),b+='{"name":"flare.'+String(this.metadata[0].category).replace(/\ /g,"").replace(/\_/g,"").replace(/\-/g,"").toLowerCase()+"."+e.id+'.x","size":1699,"imports":['+c.slice(0,c.length-1)+"]},"}),$("#debug").html(b.slice(0,b.length-1))}})}}),Vi2.PlaybackSpeed=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a),this.video=document.getElementById(this.options.videoSelector)},name:"playbackSpeed",type:"player-widget",options:{selector:".control-bar",videoSelector:"video1",speed_steps:[.3,.5,.7,1,1.5,1.7,2]},speed:1,video:"",speedIndex:3,init:function(a){var b=this;$(this.options.selector+"> .vi2-speed-controls").remove();var c=$("<div></div>").append($("<div></div>").text("1.0x").addClass("speed-label")).addClass("vi2-speed-controls").bind("mouseenter",function(a){$(".vi2-speed-controls > ul").css("display","block")}).bind("mouseleave",function(a){$(".vi2-speed-controls > ul").css("display","none")}).appendTo(this.options.selector),d=$("<ul></ul>").addClass("select-speed").appendTo(c);$.each(this.options.speed_steps,function(a,c){$("<li></li>").attr("speed",c).text(c+"x").click(function(a){b.setCurrentSpeed($(this).attr("speed"))}).appendTo(d)})},displaySpeed:function(){},getCurrentSpeed:function(){return this.speed},setCurrentSpeed:function(a){this.options.speed_steps.indexOf(parseFloat(a))!==-1&&(vi2.observer.log({context:"playbackSpeed",action:"change-speed",values:[this.speed,a]}),this.video.defaultPlaybackRate=1,this.video.playbackRate=a,this.speed=a,this.speedIndex=this.options.speed_steps.indexOf(parseFloat(a)),$(".speed-label").text(a+"x"),$(".vi2-speed-controls > ul").css("display","none"))},increaseSpeed:function(){this.speedIndex<this.options.speed_steps.length&&this.setCurrentSpeed(this.options.speed_steps[this.speedIndex+1])},decreaseSpeed:function(){this.speedIndex>1&&this.setCurrentSpeed(this.options.speed_steps[this.speedIndex-1])}}),Vi2.SkipBack=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a)},name:"skipBack",type:"player-widget",options:{selector:".control-bar",label:"",step:5},init:function(){$(this.options.selector+"> .vi2-skipback-controls").remove();var a=this;$("<div></div>").append($("<div></div>").text(this.options.label).addClass("vi2-skipback-label glyphicon glyphicon-step-backward")).addClass("vi2-skipback-controls vi2-btn").attr("title",this.options.step+"s zurückspringen").bind("click",function(b){var c=vi2.observer.player.currentTime(),d=Number(Number(c)-Number(a.options.step));vi2.observer.log({context:"skipBack",action:"skip-back",values:[c,String(d)]}),vi2.observer.player.currentTime(d)}).prependTo(this.options.selector)}}),Vi2.TableOfContents=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"toc",type:"annotation",options:{hasTimelineMarker:!0,hasMenu:!0,menuSelector:"#toc",timelineSelector:".vi2-timeline-main",allowEditing:!0,allowCreation:!0,path:"/"},currentTocElement:0,elements:[],init:function(a){var b=this,c=[];$.each(a,function(a,d){d.type===b.name&&("missing"!==d.note&&b.elements.push(d.t1),c.push({name:d.title,note:d.note,occ:[d.t1],time:[d.t1],author:d.author,date:d.date}))}),this.options.hasMenu&&this.createMenu(c),this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("toc",c,this.options.timelineSelector),vi2.observer.player.video.addEventListener("timeupdate",function(a){})},appendToDOM:function(a){var b=document.createDocumentFragment();$(vi2.dom).find('[type="toc"]').each(function(a,b){$(this).remove()}),$.each(vi2.db.getTocById(a),function(a,c){var d=document.createElement("div");d.setAttribute("type","toc"),d.setAttribute("note",c.note),d.setAttribute("starttime",c.start),d.setAttribute("duration",10),d.setAttribute("author",c.author),d.setAttribute("date",c.date);var e=document.createTextNode(decodeURIComponent(c.label));d.appendChild(e),b.appendChild(d)}),$(vi2.dom).append(b)},updateDOMElement:function(a){$(vi2.dom).find('[date="'+a.date+'"]').attr("author",vi2.wp_user).attr("date",a.date).attr("starttime",a.time).text(a.content)},addDOMElement:function(a){$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",a.date).attr("starttime",a.time).text(a.content).appendTo(vi2.dom)},begin:function(a,b,c){$(this.options.menuSelector+" li").each(function(a,b){$(this).removeClass("toc-highlight")}),$(".toc-"+c.displayPosition.t1).addClass("toc-highlight")},end:function(a,b,c){},createMenu:function(a){var b=this,c=$("<ul></ul>").addClass("toc-list");$(this.options.menuSelector).html(c),$.each(a,function(a,d){var e=$("<a></a>").text(d.name).addClass("id-"+d.occ[0]+" toc-menu-link").attr("href","#!/video/"+vi2.observer.current_stream+"/t=npt:"+d.occ[0]),f=vi2.db.getUserById(d.author),g=$("<li></li>").addClass("toc-"+d.occ[0]).attr("id","toc"+d.occ[0]).attr("title",f.username+", "+moment(Number(d.date),"x").fromNow()).html(e).appendTo(c);if(b.options.allowEditing){$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-pencil tiny-edit-btn-"+b.name).attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","toc").data("annotationdata",{content:d.name,time:d.occ[0],date:d.date,author:d.author}).appendTo(g)}"missing"===d.note?g.addClass("toc-disabled"):g.click(function(){vi2.observer.log({context:"toc",action:"menu-click",values:[d.name.replace(/,/g,"##"),d.author,d.occ[0]]}),vi2.observer.player.currentTime(d.occ[0]),b.currentTocElement=a})})},createAnnotationForm:function(a){var b="\t\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='toc-form1'>Kapitelbezeichnung</span>\t\t\t\t<input type='text' class='form-control' value='<%= content %>' name='toc-entry' data-datatype='string' placeholder='' aria-describedby='toc-form1'>\t\t\t\t</div><br>\t\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='toc-form1'>Wiedergabezeit</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='toc-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='toc-form1'>\t\t\t\t</div>\t\t\t\t";return a?ejs.render(b,a):ejs.render(b,{content:"",time:vi2.observer.player.currentTime(),author:vi2.wp_user,date:(new Date).getTime()})},getAnnotationFormData:function(a){var b={};return b.content=$(a).find('[name="toc-entry"]').attr("value"),b.time=$(a).find('[name="toc-entry-time"]').attr("value"),b},nextElement:function(){this.currentTocElement=this.currentTocElement<this.elements.length?this.currentTocElement+1:this.currentTocElement,vi2.observer.player.currentTime(this.elements[this.currentTocElement]),vi2.observer.log({context:"toc",action:"jump-next",values:[this.currentTocElement]})},previousElement:function(){this.currentTocElement=0===this.currentTocElement?this.currentTocElement:this.currentTocElement-1,vi2.observer.player.currentTime(this.elements[this.currentTocElement]),vi2.observer.log({context:"toc",action:"jump-back",values:[this.currentTocElement]})}}),Vi2.Hyperlinks=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"hyperlinks",type:"annotation",options:{displaySelector:"#seq",hasTimelineMarker:!0,timelineSelector:".vi2-timeline-top",hasMenu:!0,menuSelector:"#hyperlinks",minDuration:5,allowEditing:!0,allowCreation:!0,path:"/static/img/user-icons/"},player:null,link_list:{},currLinkId:-1,init:function(a){var b=[];$.each(a,function(a,c){"cycle"!==c.linktype&&"standard"!==c.linktype&&"external"!==c.linktype||b.push({name:c.title,occ:[c.t1],target:c.target,description:c.description,time:[c.t1],duration:c.t2,x:c.x,y:c.y,date:c.date,author:c.author})}),this.options.hasMenu&&this.createMenu(b),this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("hyperlinks",b,this.options.timelineSelector)},appendToDOM:function(a){$(vi2.dom).find('[type="hyperlinks"]').each(function(a,b){$(this).remove()}),$(vi2.dom).find('[type="cycle"]').each(function(a,b){$(this).remove()}),$.each(vi2.db.getLinksById(a),function(a,b){$("<div></div>").attr("type",b.type).attr("starttime",b.starttime).attr("duration",b.duration).attr("posx",b.x).attr("posy",b.y).attr("seek",vi2.utils.deci2seconds(this.seek)).attr("duration2",vi2.utils.deci2seconds(this.duration2)).attr("target",b.target).attr("description",decodeURIComponent(b.description)).attr("author",b.author).attr("date",b.date).text(decodeURIComponent(b.title)).appendTo(vi2.dom)})},updateDOMElement:function(a){$(vi2.dom).find('[date="'+a.date+'"]').attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",a.time).attr("description",decodeURIComponent(a.content.description)).attr("duration",void 0===a.content.duration?"10":a.content.duration).attr("posx",void 0===a.content.x?"20":a.content.x).attr("posy",void 0===a.content.y?"80":a.content.y).attr("seek",0).attr("duration2",0).attr("target",a.content.target).text(decodeURIComponent(a.content.label))},addDOMElement:function(a){$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",a.time).attr("duration",void 0===a.content.duration?"10":a.content.duration).attr("posx",void 0===a.content.x?"20":a.content.x).attr("posy",void 0===a.content.y?"80":a.content.y).attr("seek",0).attr("duration2",0).attr("target",a.content.target).attr("description",decodeURIComponent(a.content.description)).text(decodeURIComponent(a.content.label)).appendTo(vi2.dom)},createMenu:function(a){var b=this,c=$("<ul></ul>").addClass("hyperlinks-list");$(this.options.menuSelector).html(c),$.each(a,function(a,d){var e=$("<a></a>").text(decodeURIComponent(d.name)).addClass("id-"+d.occ[0]).attr("href","#!/video/"+vi2.observer.current_stream+"/t=npt:"+d.occ[0]),f=vi2.db.getUserById(d.author),g=$("<li></li>").addClass("hyperlinks-"+d.occ[0]).attr("id",""+d.occ[0]).attr("title",f.username+", "+moment(Number(d.date),"x").fromNow()).html(e).appendTo(c),h={time:d.occ[0],date:d.date,author:d.author,content:{label:d.name,date:d.date,duration:d.duration,description:d.description,target:d.target,x:d.x,y:d.y,seek:0,duration2:0}};if(b.options.allowEditing){$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-pencil tiny-edit-btn-"+b.name).attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","hyperlinks").data("annotationdata",h).appendTo(g)}g.click(function(){vi2.observer.log({context:"hyperlinks",action:"menu-click",values:[d.name,d.author,d.occ[0]]}),vi2.observer.player.currentTime(d.occ[0]),b.currentTocElement=a})}),c.find("li").tsort({attr:"id"})},begin:function(a,b,c){this.currLinkId=b;var d=this,e=$("<span></span>"),f=/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi,g=new RegExp(f);c.content.target.match(g)?(c.linktype="external",e.addClass("glyphicon glyphicon-share-alt")):(c.linktype="standard",e.addClass("glyphicon glyphicon-link"));$("<a></a>").text(" "+decodeURIComponent(c.content.title)).attr("id","ov"+b).attr("href",c.content.target).attr("title",c.content.description).addClass("overlay ov-"+b+" hyperlink-"+c.linktype).bind("click",function(a){switch(vi2.observer.log({context:"hyperlinks",action:"link-"+c.linktype+"-click",values:[c.content.target,c.author,c.displayPosition.t1]}),c.linktype){case"standard":return!0;case"external":return!0;case"cycle":var b=c.content.target.replace(/\#!/,"");vi2.observer.setCurrentStream(b);var e={title:"return to: "+c.content.title,target:String(d.player.url).replace(/.webm/,"").replace(/videos\/iwrm\_/,""),linktype:"standard",type:"xlink",x:2,y:93,t1:c.seek,t2:c.duration,seek:c.displayPosition.t1,duration:0};vi2.observer.vid_arr[0].annotation.push(e);break;case"x":}d.loadVideo(vi2.observer.vid_arr[0].url,c.seek),$(this).remove()}).prepend(e).appendTo(this.options.displaySelector).css({left:c.displayPosition.x+"%",top:c.displayPosition.y+"%",position:"absolute"}).effect("highlight",2e3)},end:function(a,b){$(this.options.displaySelector+" .ov-"+b).hide()},clear:function(){$(this.options.displaySelector).html(""),$(".vi2-video-seeklink").html("")},
createAnnotationForm:function(a){var b="\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form1'>ULR</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.target %>' name='hyperlinks-entry-url' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form1'>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form1'>Bezeichner</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.label %>' name='hyperlinks-entry-label' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form12'>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form2'>Beschreibung</span>\t\t\t\t<textarea name='hyperlinks-entry-desc' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form2'><%= content.description %></textarea>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form3'>Zeitpunkt (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='hyperlinks-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Anzeigedauer (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.duration %>' name='hyperlinks-entry-duration' data-datatype='decimal-time' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Position x (%)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.x %>' name='hyperlinks-entry-x' data-datatype='number' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Position y (%)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.y %>' name='hyperlinks-entry-y' data-datatype='number' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t";return""!==a.content?(a.content.description=decodeURIComponent(a.content.description),a.content.label=decodeURIComponent(a.content.label),ejs.render(b,a)):ejs.render(b,{content:{description:"",target:"",label:"",duration:10,x:50,y:50},time:vi2.observer.player.currentTime(),date:(new Date).getTime(),author:vi2.wp_user})},getAnnotationFormData:function(a){return{time:$(a).find('[name="hyperlinks-entry-time"]').attr("value"),content:{label:$(a).find('[name="hyperlinks-entry-label"]').val(),target:$(a).find('[name="hyperlinks-entry-url"]').val(),description:$(a).find('[name="hyperlinks-entry-desc"]').val(),duration:$(a).find('[name="hyperlinks-entry-duration"]').val(),x:$(a).find('[name="hyperlinks-entry-x"]').val(),y:$(a).find('[name="hyperlinks-entry-y"]').val(),seek:0,duration2:0}}},loadVideo:function(a,b){this.player.loadVideo(a,b)},loadCycleVideo:function(a,b,c,d){this.player.loadCycleVideo(a,b,c,d)}}),Vi2.Comments=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"comments",type:"annotation",options:{hasTimelineMarker:!0,hasMenu:!0,menuSelector:"#comments",allowEmoticons:!0,allowReplies:!0,allowEditing:!0,allowCreation:!0,timelineSelector:".vi2-timeline-buttom",path:"/"},player:null,init:function(a){null===a&&(a={});var b=this,c=[];$.each(a,function(a,d){d.type===b.name&&c.push({name:d.title,occ:[d.t1],time:[d.t1],date:d.date,author:d.author})}),this.options.hasMenu&&this.createMenu(c),this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("comments",c,this.options.timelineSelector)},createMenu:function(a){var b=this,c=-1,d=$("<ul></ul>").addClass("comments-list");$(this.options.menuSelector).html(d),a=a.sort(function(a,b){return Number(a.time)>Number(b.time)?1:-1}),moment.locale("de"),$.each(a,function(a,e){var f=$("<a></a>").text(e.name).addClass("id-"+e.time+" comments-menu-question").click(function(){vi2.observer.log({context:"comments",action:"menu-click",values:[e.name,e.author,e.time[0]]}),b.player.currentTime(e.time[0])});b.options.allowEmoticons&&f.emoticonize({});var g=vi2.db.getUserById(e.author),h=$("<span></span>").addClass("comments-header");$("<span></span>").text(g.username).addClass("comments-user").appendTo(h),h.append(" "+moment(Number(e.date),"x").fromNow());var i=$("<li></li>").addClass("list-item").addClass("t"+e.time).attr("author",e.author).attr("date","d"+e.date).attr("id","t"+b.formatTime(e.time,"-")).html(h).append(f).appendTo(d);if(Number(e.time)===Number(c)&&i.css({"margin-left":"15px"}),b.options.allowEditing&&Number(e.author)===Number(vi2.wp_user)){$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-pencil").attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","comments").data("annotationdata",{content:e.name,time:e.time,date:e.date,author:e.author}).appendTo(h)}if(b.options.allowReplies){$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-arrow-right").attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","comments").data("annotationdata",{content:"",time:e.time,date:(new Date).getTime()}).appendTo(h)}c=e.time})},appendToDOM:function(a){$(vi2.dom).find('[type="comments"]').each(function(a,b){$(this).remove()}),$.each(vi2.db.getCommentsById(a),function(a,b){$("<div></div>").attr("type","comments").attr("starttime",b.start).attr("duration",10).attr("author",b.author).attr("date",b.date).text(decodeURIComponent(b.comment)).appendTo(vi2.dom)})},updateDOMElement:function(a){$(vi2.dom).find('[date="'+a.date+'"]').attr("author",vi2.wp_user).attr("date",a.date).attr("starttime",a.time).text(a.content)},addDOMElement:function(a){$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",a.time).text(a.content).appendTo(vi2.dom)},begin:function(a,b,c){$(this.options.menuSelector+" li").each(function(a,b){$(this).removeClass("vi2-highlight")}),$(this.options.menuSelector+" li.t"+c.displayPosition.t1).addClass("vi2-highlight")},end:function(a,b){$(this.options.menuSelector+" li ").removeClass("vi2-highlight")},createAnnotationForm:function(a){var b="\t\t\t<textarea name='comments-entry' data-datatype='string' placeholder='' aria-describedby='comments-form1'><%= content %></textarea>\t\t\t<br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='comments-form1'>Zeitpunkt (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='comments-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='comments-form1'>\t\t\t</div>\t\t\t";return a?ejs.render(b,a):ejs.render(b,{content:"",time:vi2.observer.player.currentTime(),date:(new Date).getTime(),author:vi2.wp_user})},getAnnotationFormData:function(a){var b={};return b.content=$(a).find('[name="comments-entry"]').val(),b.time=$(a).find('[name="comments-entry-time"]').attr("value"),b}}),Vi2.SyncronizeMedia=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"syncMedia",type:"annotation",options:{selector:"#seq",hasTimelineMarker:!0,controls:!0,timelineSelector:".vi2-timeline-main",hasMenu:!1,menuSelector:".synMediaMenu",prefix_path:"/static/img/slides/",sync:!0,placeholder:"/static/img/placeholder.jpg"},tag_obj:[],currImgId:-1,init:function(a){var b=this;this.tag_obj=[],$.each(a,function(a,c){if("syncMedia"==c.type){var d=b.get_tag_by_name(c.title);d==-1?b.tag_obj.push({tagname:c.title,path:c.target,occ:[{start:c.t1,duration:c.t2,xpos:c.x,ypos:c.y}]}):b.tag_obj[d].occ.push({start:c.t1,duration:c.t2,x:c.x,y:c.y})}}),$(this.options.selector).html(new Image).addClass(this.options.childtheme),this.currImgId=-1;var c=new Image;$(c).attr("src",this.options.placeholder).addClass("slide").unbind("click").appendTo(this.options.selector)},createMenu:function(){$(this.options.selector).empty();var a=$("<ul></ul>").addClass("highlight-list").appendTo(this.options.selector);$.each(this.tag_obj,function(b,c){$("<li></li>").addClass("list-item").attr("id",c.tagname.replace(" ","--")).append($("<a></a>").attr("freq",c.occ.length).addClass("id-"+c.tagname.replace(" ","--")).text(c.tagname+" ").css("font-size",c.occ.length/10<1?c.occ.length/10+1+"em":c.occ.length/10>2?"2em":_freq/10+"em").bind("click",{tags:c},function(a){vi2.observer.player.currentTime(c.occ[0].start),vi2.observer.player.pause(),$("#video1").addClass("split"),$(".highlight-element").remove();var b=new Image;$(b).attr("src",c.path).addClass("slide ov-").unbind("load").bind("load",function(a){$("#seq").find(".helper").remove();$("<div></div>").addClass("helper").append(b).appendTo("#seq")}),vi2.observer.log({context:"syncMedia",action:"menu-click",values:[c.tagname,"",c.occ]})})).appendTo(a)}),$(vi2.observer.player).on("player.play",function(a){$("#video1").removeClass("split"),$("#seq").find(".helper").remove()});var b={};b.attr="freq"==this.options.sort?"freq":"",b.order="desc"==this.options.order?"desc":"asc",a.find("a").tsort(b),$(a).find("li:gt("+(this.options.max-1)+") > a").hide()},appendToDOM:function(a){$(vi2.dom).find('[type="syncMedia"]').each(function(a,b){$(this).remove()}),$.each(vi2.db.getSlidesById(a),function(a,b){$("<div></div>").attr("type","syncMedia").attr("starttime",b.starttime).attr("duration",b.duration).attr("id",b.id).attr("path",b.img).text(this.tagname).appendTo(vi2.dom)})},begin:function(a,b,c){this.options.sync&&this.placeMedia(a,b,c)},end:function(a,b){$(this.options.selector+" .ov-"+b).remove()},placeMedia:function(a,b,c){if(this.currImgId==c.content.target)return!1;var d=this;this.currImgId=c.content.target;var e=new Image;$(e).attr("src",this.options.prefix_path+"/"+c.content.target.replace("700/","video5/")).addClass("slide ov-"+b).unbind("load").bind("load",function(a){$(d.options.selector).html(e),$("#overlay").css("width",$(".slide").width())})},get_tag_by_name:function(a){var b=-1;return $.each(this.tag_obj,function(c,d){d.tagname==a&&(b=c)}),b},loadVideo:function(a,b){vi2.observer.player.loadVideo(a,b)},width:function(){return this.width},height:function(){return this.height}}),Vi2.Assessment=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"assessment",type:"annotation",options:{displaySelector:"#overlay",hasTimelineMarker:!0,timelineSelector:".vi2-timeline-top",hasMenu:!0,menuSelector:"#assessment",allowComments:!0,allowEditing:!0,allowCreation:!0,path:"/static/img/user-icons/"},init:function(a){var b=[];$.each(a,function(a,c){"assessment"===c.type&&""!==c.title&&b.push({name:c.title,occ:[c.t1],time:[c.t1],author:c.author,date:c.date})}),this.options.hasMenu&&this.createMenu(b),this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("assessment",b,this.options.timelineSelector)},createMenu:function(a){var b=this;$(this.options.menuSelector).empty();var c=$("<ul></ul>").addClass("assessment-list").appendTo(this.options.menuSelector);$.each(a,function(a,d){var e=vi2.db.getUserById(d.author),f=$("<span></span>").addClass("assessment-header");$("<span></span>").text(e.username).addClass("assessment-user").appendTo(f),f.append(" "+moment(Number(d.date),"x").fromNow());var g=new Image;$(g).addClass("assessment-user-icon");var h=$("<a></a>").append(d.name.question).attr("author",d.author).addClass("id-"+d.time+" assessment-menu-question").click(function(){vi2.observer.log({context:"assessment",action:"menu-click",values:[d.name.question,d.author,d.time]}),vi2.observer.player.currentTime(d.time)});$("<li></li>").attr("id","t"+d.time).attr("author",d.author).addClass("list-item").html(f).append(h).appendTo(c);if(b.options.allowEditing&&Number(d.author)===Number(vi2.wp_user)){$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-pencil").attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","assessment").data("annotationdata",{content:d.name,time:d.time[0],date:d.date,author:d.author}).appendTo(f)}}),c.find("li").tsort({attr:"id"})},appendToDOM:function(a){$(vi2.dom).find('[type="assessment"]').each(function(a,b){$(this).remove()}),$.each(vi2.db.getAssessmentById(a),function(a,b){$("<div></div>").attr("type","assessment").attr("starttime",b.start).attr("duration",10).attr("author",b.author).attr("date",b.date).attr("id","assessment-"+a).data("task",b.title).appendTo(vi2.dom)})},updateDOMElement:function(a){$(vi2.dom).find('[date="'+a.date+'"]').attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",a.time).data("task",a.content)},addDOMElement:function(a){$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",a.time).data("task",a.content).appendTo(vi2.dom)},begin:function(a,b,c){$("body").unbind("keydown");var d=this,e="vi2assessment"+b;vi2.observer.player.pause(),vi2.observer.log({context:"assessment",action:"display-question",values:[encodeURIComponent(c.content.title.question),c.author,vi2.observer.player.currentTime()]});var f=$("<div></div>").attr("id","vi2assessment").addClass(e).html("").show(),g=$("<h3></h3>").text("Testfrage"),h=$("<div></div>").addClass("assessment-question").text(""+c.content.title.question),i=$("<div></div>").addClass("assessment-answers");if(c.content.title.answ.length>0)if(1===c.content.title.answ.length&&"fi"===c.content.title.answ[0].questiontype){$("<div></div>").attr("id","answ0").addClass("assessment-answer").append('<textarea name="quest"></textarea>').append("<br/>").appendTo(i)}else $.each(c.content.title.answ,function(a,b){$("<div></div>").attr("id",b.id).addClass("assessment-answer").append($('<input type="checkbox" name="quest" value="1" />').attr("id",b.id)).append(b.answ).click(function(){$(this).find('input[type="checkbox"]').trigger("click")}).append("<br/>").appendTo(i)});var j=$("<button></button>").addClass("btn btn-default assessment-btn").text("abschicken").click(function(){$(this).hide(),d.evaluateAnswer("."+e,c.content.title,c.author)}),k=$("<a></a>").text(" Frage überspringen").click(function(){$(e).remove(),vi2.observer.log({context:"assessment",action:"skip-question",values:[encodeURIComponent(c.content.title.question),c.author,vi2.observer.player.currentTime()]}),vi2.observer.player.play(),$("body").unbind("keydown").bind("keydown",function(a){vi2.observer.player.keyboardCommandHandler(a)})});$(f).append(g).append(h).append(i).append(j).append(k),$(this.options.displaySelector).append(f)},end:function(a,b){$(".vi2assessment"+b).remove()},createAnnotationForm:function(a){""===a.content&&(a={time:vi2.observer.player.currentTime(),date:(new Date).getTime(),author:vi2.wp_user,content:{question:"",answ:[],correct:[],time:vi2.observer.player.currentTime(),date:(new Date).getTime()}});var b=$("<textarea></textarea>").attr("id","annotationQuestion").val(a.content.question),c=$("<div></div>").attr("id","answerbox"),d=0,e=$("<div></div>").append($("<span></span>").addClass("glyphicon glyphicon-plus ")).addClass("mc-question add-btn").append(" Multiple-Choice-Antwort hinzufügen").click(function(){var a=$("<span></span>").addClass("close-btn glyphicon glyphicon-remove-circle").attr("title","Antwortoption entfernen").click(function(){$(this).parent().remove(),0===$(".answer").length?($(".fi-question").show(),$(".mc-question").show()):($(".fi-question").hide(),$(".mc-question").show())});$(".fi-question").hide();var b="answ"+Math.ceil(100*Math.random()),e=$("<div></div>").attr("id",b).addClass("answer").append('<input id="'+b+'" type="checkbox" title="Setze ein Häckchen für richtige Lösungen" name="quest" value="1" />').append('<input id="'+b+'" type="text" class="mc-option" value=""/>').append(a).append("<br/>");d++,c.append(e)}),f=$("<div></div>").append($("<span></span>").addClass("glyphicon glyphicon-align-left")).addClass("fi-question  add-btn").append(" Freitext-Antwort hinzufügen").click(function(){var a=$("<span></span>").addClass("close-btn glyphicon glyphicon-remove-circle").attr("title","Lösung entfernen").click(function(){$(this).parent().remove(),0===$(".answer").length?($(".fi-question").show(),$(".mc-question").show()):($(".fi-question").hide(),$(".mc-question").hide())});$(".mc-question").hide(),$(".fi-question").hide();var b=$("<div></div>").attr("id","answ"+Math.ceil(100*Math.random())).addClass("answer fi-answer").append($("<label></label>").text("Lösung:")).append("<textarea></textarea>").append(a).append("<br/>");d++,c.append(b)});if(a.content.answ.length>0)if("mc"===a.content.answ[0].questiontype)$.each(a.content.answ,function(b,d){var e=$("<span></span>").addClass("close-btn glyphicon glyphicon-remove-circle").attr("title","Antwortoption entfernen").click(function(){$(this).parent().remove(),0===$(".answer").length?($(".fi-question").show(),$(".mc-question").show()):($(".fi-question").hide(),$(".mc-question").show())}),f=$('<input type="checkbox" title="Setze ein Häckchen für richtige Lösungen" name="quest" value="1" />').attr("id",d.id);a.content.correct.indexOf(d.id)!==-1&&f.attr("checked",!0);$("<div></div>").attr("id",d.id).addClass("answer").append(f).append($('<input type="text" class="mc-option" />').attr("id",d.id).val(d.answ)).append(e).append("<br/>").appendTo(c)});else if("fi"===a.content.answ[0].questiontype){var g=$("<span></span>").addClass("close-btn glyphicon glyphicon-remove-circle").attr("title","Lösung entfernen").click(function(){$(this).parent().remove(),0===$(".answer").length?($(".fi-question").show(),$(".mc-question").show()):($(".fi-question").hide(),$(".mc-question").hide())});$("<div></div>").attr("id","answ"+Math.ceil(100*Math.random())).addClass("answer fi-answer").append($("<label></label>").text("Lösung:")).append($("<textarea></textarea>").val(a.content.answ[0].answ)).append(g).append("<br/>").appendTo(c)}var h="\t\t\t\t<div class='input-group'>\t\t\t\t\t<span class='input-group-addon' id='hyperlinks-form3'>Zeitpunkt (s)</span>\t\t\t\t\t<input type='text' class='form-control' value='"+a.time+"' name='assessment-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t\t</div>",i=$("<div></div>").addClass("questionanswers").append($("<label></label>").text("Frage:")).append(b).append(c).append(e).append(f).append(h);return void 0!==a.content.answ&&(void 0!==a.content.answ[0]&&"mc"===a.content.answ[0].questiontype&&f.hide(),void 0!==a.content.answ[0]&&"fi"===a.content.answ[0].questiontype&&(e.hide(),f.hide())),i},validateAnnotationForm:function(a,b){var c=0,d=0,e="";return $(a).find("#annotationQuestion").each(function(a,b){String($(b).val()).length<2?($(b).addClass("validation-conflict"),c=!0):$(b).removeClass("validation-conflict")}),c&&(e+="<br> Definieren Sie bitte einen Text für diese Frage."),0===$("#answerbox").find("div").length?e+="<br> Bitte definieren Sie für diese Frage entsprechende Antwortoptionen oder Lösungen.":($("#answerbox").find("textarea").each(function(a,b){String($(b).val()).length<2?($(b).addClass("validation-conflict"),c=!0):$(b).removeClass("validation-conflict")}),c&&(e+="<br> Definieren Sie bitte die Lösung zu der Frage."),$("#answerbox").find("input[type=text]").each(function(a,b){""===$(b).val()?($(b).addClass("validation-conflict"),d=!0):$(b).removeClass("validation-conflict")}),d&&(e+="<br> Versehen Sie bitte jede Antwortoption mit einem Text."),$("#answerbox").find("input[type=checkbox]").length>0&&0===$("#answerbox").find("input:checked").length?($("#answerbox").find("input[type=checkbox]").addClass("validation-conflict"),e+="<br> Mindestens eine Antwortoption sollte als richtig markiert werden."):$("#answerbox").find("input[type=checkbox]").removeClass("validation-conflict")),0===String(e).length?e:(console.log("Validation Error:"+e),e)},getAnnotationFormData:function(a){var b={time:$(a).find('[name="assessment-entry-time"]').val(),content:{question:$("#annotationQuestion").val(),time:$("#annotationTime").attr("value"),date:String((new Date).getTime()),answ:[],correct:[]}};return $("#answerbox").find("textarea").each(function(a,c){b.content.answ[a]={id:$(c).attr("id"),answ:$(c).val(),questiontype:"fi"}}),$("#answerbox").find("input[type=text]").each(function(a,c){b.content.answ[a]={id:$(c).attr("id"),answ:$(c).val(),questiontype:"mc"}}),$("#answerbox").find(":checked").each(function(a,c){b.content.correct.push($(c).attr("id"))}),b},evaluateAnswer:function(a,b,c){var d=!1,e=[];if("fi"===b.answ[0].questiontype)String($("#answ0 > textarea").val()).length>3&&(e.push(!0),vi2.observer.log({context:"assessment",action:"submited-answer",values:[encodeURIComponent(b.question),c,vi2.observer.player.currentTime(),encodeURIComponent($(".assessment-answers").find("textarea").val())]}),$(a).append($("<p><strong>Vielen Dank für die Bearbeitung der Frage. Folgende Musterlösung wurde für diese Frage hinterlegt:</strong></p>")).addClass("assessment-msg-correct"),$("<div></div>").text(b.answ[0].answ).addClass("correct-answ").appendTo(a));else{if(b.checked=[],$(".assessment-msg-warning").hide(),$("div.assessment-answers").find("input[type='checkbox']:checked").each(function(a,c){b.checked.push($(c).attr("id")),d=!0,b.correct.indexOf($(c).attr("id"))>-1?e.push(!0):e.push(!1)}),!d)return $(a).append($("<p>Bitte wählen Sie eine Antwortoption</p>").addClass("assessment-msg-warning")),$(".assessment-btn").show(),!1;vi2.observer.log({context:"assessment",action:"submited-answer",values:[encodeURIComponent(b.question),c,vi2.observer.player.currentTime(),b.checked.toString()]}),e.indexOf(!1)===-1?(vi2.observer.log({context:"assessment",action:"submited-correct-result",values:[encodeURIComponent(b.question),c,vi2.observer.player.currentTime()]}),$(a).append($("<p>Ihre Antwort ist richtig.</p>").addClass("assessment-msg-correct"))):(vi2.observer.log({context:"assessment",action:"submited-incorrect-result",values:[encodeURIComponent(b.question),c,vi2.observer.player.currentTime()]}),$(a).append($("<p>Ihre Antwort ist leider falsch.</p>").addClass("assessment-msg-wrong")))}b.type=b.answ[0].questiontype;({from:vi2.wp_user,date:(new Date).getTime(),type:"test-result",read:!1,replied:!1,title:"Result: "+encodeURIComponent(b.question),content:{correct:e,question:encodeURIComponent(b.question),answ:b.answ,res:"mc"===b.type?encodeURIComponent(b.checked):encodeURIComponent($(".assessment-answers").find("textarea").val()),videoid:vi2.currentVideo}}),$("<button></button>").addClass("btn btn-default").text("Video fortsetzen").click(function(){$(a).remove(),vi2.observer.log({context:"assessment",action:"continue-playback",values:[encodeURIComponent(b.question),c,vi2.observer.player.currentTime()]}),vi2.observer.player.play(),$("body").unbind("keydown").bind("keydown",function(a){vi2.observer.player.keyboardCommandHandler(a)})}).appendTo(a)}}),Vi2.Analysis=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"assessmentanalysis",type:"annotation",options:{selector:".control-bar",hasTimelineMarker:!0,hasMenu:!0,menuSelector:"#assessmentanalysis",displaySelector:"#overlay",hasMarker:!0,hasMarkerSelect:!0,selectData:["Cat A","Cat B","Cat C"],hasMarkerLabel:!0,hasMarkerComment:!0,hasMarkerDescription:!0,hasMarkerDescription2:!0,allowEmoticons:!0,allowReplies:!1,allowEditing:!1,allowCreation:!0,timelineSelector:".vi2-timeline-top",path:"/"},player:null,currentMarker:-1,annotation_flag:!1,marker_template:['<div class="analysis-marker-annotate">','<span class="analysis-marker-annotate-fill"></span>','<span class="input-wraper right top">','<input id="marker-text-label" type="text" placeholder="Label" class="marker-element" title="Label" />','<textarea id="marker-description" class="marker-element" placeholder="Beschreibung" title="Beschreibung der Markierung"></textarea>','<textarea id="marker-description2" class="marker-element" placeholder="Beurteilung" title="Beurteilung"></textarea>','<a class="save-btn vi2-analysis-btn">speichern</a>','<a class="remove-btn vi2-analysis-btn glyphicon glyphicon-remove"></a>',"</span>","</div>"].join(""),init:function(a){null===a&&(a={});var b=this,c=[];if($.each(a,function(a,d){d.type===b.name&&c.push({name:d.title,occ:[d.t1],time:[d.t1],x:d.x,y:d.y,date:d.date,author:d.author,markertype:d.markertype,markerlabel:d.markerlabel,markerselectoption:d.markerselectoption,markerdescription:d.markerdescription,markerdescription2:d.markerdescription2,id:d.id})}),this.options.hasMenu&&this.createMenu(c),this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("analysis",c,this.options.timelineSelector),this.options.allowCreation){$(this.options.selector+"> .vi2-analysis-controls").remove();$("<div></div>").append($("<div></div>").addClass("vi2-analysis-label glyphicon glyphicon-plus")).addClass("vi2-analysis-controls vi2-btn").attr("title","Markierung hinzufügen").bind("click",{},function(a){b.addMarker()}).appendTo(this.options.selector)}},addMarker:function(){var a=this,b=vi2.observer.player.currentTime(),c="markerid"+Math.ceil(1e3*Math.random());if(!a.annotation_flag){a.annotation_flag=!0,vi2.observer.player.pause();var d=$("<div></div>").append(a.marker_template);d.find(".analysis-marker-annotate").addClass(c),$(a.options.displaySelector).append(d.find(".analysis-marker-annotate"));var e=($("."+c+" .remove-btn").click(function(b){a.annotation_flag=!1,$(e).hide(),vi2.observer.player.play()}),$("."+c+" .save-btn").bind("click",{},function(d){a.annotation_flag=!1,a.addDOMElement({type:a.name,id:c,date:(new Date).getTime(),author:vi2.wp_user,y:(($(this).parent().parent().offset().top-$("video").offset().top)/$("video").height()*100).toFixed(0),x:(($(this).parent().parent().offset().left-$("video").offset().left)/$("video").width()*100).toFixed(0),starttime:b,duration:"10",markertype:"marker-label-desc",markerlabel:$(this).parent().find("#marker-text-label").val(),markerselectoption:"cat a",markerdescription:$(this).parent().find("#marker-description").val(),markerdescription2:$(this).parent().find("#marker-description2").val()}),a.saveDOM(),$("."+c).hide(),vi2.observer.player.play()}),$("."+c).css({left:"49%",top:"20%",position:"absolute"}).show().draggable({containment:"parent",drag:function(a){var b=($(this).offset().left-$("video").offset().left)/$("video").width()*100,c=($(this).offset().top-$("video").offset().top)/$("video").height()*100;b>50?$(".input-wraper").addClass("left").removeClass("right"):$(".input-wraper").addClass("right").removeClass("left"),c>50?$(".input-wraper").addClass("bottom").removeClass("top"):$(".input-wraper").addClass("top").removeClass("bottom")}}))}},createMenu:function(a){var b=this,c=-1,d=$("<ul></ul>").addClass("analysis-list");$("#assessmentanalysis").html(d),a=a.sort(function(a,b){return Number(a.time)>Number(b.time)?1:-1}),moment.locale("de"),$.each(a,function(a,e){var f=$("<a></a>").text(e.markerlabel+"").addClass("id-"+e.time+" analysis-menu-question").click(function(){vi2.observer.log({context:"analysis",action:"menu-click",values:[e.name,e.author,e.time[0]]}),b.player.currentTime(e.time[0])});b.options.allowEmoticons;var g=vi2.db.getUserById(e.author),h=$("<span></span>").addClass("analysis-header");g.firstname=void 0!==g.firstname?g.firstname:"user ",g.name=void 0!==g.name?g.name:"",$("<span></span>").text(g.firstname+" "+g.name+" ").text(g.username).addClass("analysis-user").appendTo(h),h.append("  _"+moment(Number(e.date),"x").fromNow());var i=$("<li></li>").addClass("list-item").addClass("t"+Number(e.time[0].replace(".",""))).attr("author",e.author).attr("date","d"+e.date).attr("id","t"+b.formatTime(e.time,"-")).html(h).append(f).appendTo(d);Number(e.time)===Number(c)&&i.css({"margin-left":"15px"});$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-remove").bind("click",function(){$("."+e.id).remove(),b.removeDOMElement(e.id)}).appendTo(h);c=e.time})},saveDOM:function(){var a=this,b=[];$(vi2.dom).find("div[type='"+a.name+"']").each(function(a,c){var d={};d.target=void 0===$(c).attr("starttime")?0:$(c).attr("starttime"),d.linktype="",d.x=$(c).attr("x"),d.y=$(c).attr("y"),d.t1=void 0===$(c).attr("starttime")?0:$(c).attr("starttime"),d.t2=void 0===$(c).attr("duration")?1:$(c).attr("duration"),d.marker=$(c).data("marker"),d.markertype=$(c).attr("markertype"),d.markerlabel=$(c).attr("markerlabel"),d.markerdescription=$(c).attr("markerdescription"),d.markerdescription2=$(c).attr("markerdescription2"),d.markerselectoption=$(c).attr("markerselectoption"),d.id=$(c).attr("id"),b.push(d)}),$.post("/videos/annotate",{data:b,annotationtype:a.name,videoid:vi2.videoData._id},function(a){socket.emit("video.updated",{videoid:vi2.currentVideo}),vi2.observer.setAnnotations()})},appendToDOM:function(a){var b=this;$(vi2.dom).find('[type="'+b.name+'"]').each(function(a,b){$(this).remove()}),$.each(vi2.db.getAnalysisById(a),function(a,c){$("<div></div>").attr("type",b.name).attr("author",c.author).attr("date",c.date).attr("starttime",c.t1).attr("duration",10).attr("x",c.x).attr("y",c.y).attr("markertype",c.markertype).attr("markerlabel",c.markerlabel).attr("markerselectoption",c.markerselectoption).attr("markerdescription",c.markerdescription).attr("markerdescription2",c.markerdescription2).attr("id",c.id).text(decodeURIComponent(c.analysis)).appendTo(vi2.dom)})},updateDOMElement:function(a){$(vi2.dom).find("div[id='"+a.id+"']").each(function(a,b){$(this).remove()}),$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",a.date).attr("starttime",a.starttime).attr("duration",a.duration).attr("x",a.x).attr("y",a.y).attr("markertype",a.markertype).attr("markerlabel",a.markerlabel).attr("markerselectoption",a.markerselectoption).attr("markerdescription",a.markerdescription).attr("markerdescription2",a.markerdescription2).attr("id",a.id).text(a.markerlabel).appendTo(vi2.dom),this.saveDOM()},addDOMElement:function(a){$("<div></div>").attr("id",a.id).attr("type",a.type).attr("author",vi2.wp_user).attr("date",a.date).attr("x",a.x).attr("y",a.y).attr("starttime",a.starttime).attr("duration",a.duration).attr("markertype",a.markertype).attr("markerlabel",a.markerlabel).attr("markerselect_option",a.markerselectoption).attr("markerdescription",a.markerdescription).attr("markerdescription2",a.markerdescription2).data("marker",a).text(a.markerlabel).appendTo(vi2.dom)},removeDOMElement:function(a){$(vi2.dom).find("div[id='"+a+"']").each(function(a,b){$(this).remove()}),this.saveDOM()},begin:function(a,b,c){var d=this;if(this.currentMarker!==c.data.id){this.currentMarker=c.data.id,$("."+c.data.id).remove(),vi2.observer.player.pause();var e=$("<div></div>").append(d.marker_template);e.find(".analysis-marker-annotate").attr("title",c.data.markerlabel).addClass(c.data.id).css({left:c.displayPosition.x+"%",top:c.displayPosition.y+"%",position:"absolute"}),$(d.options.displaySelector).append(e.find(".analysis-marker-annotate")),$("."+c.data.id+" #marker-text-label").val(c.data.markerlabel),$("."+c.data.id+" #marker-description").val(c.data.markerdescription),$("."+c.data.id+" #marker-description2").val(c.data.markerdescription2);var f=($("."+c.data.id).offset().left-$("video").offset().left)/$("video").width()*100,g=($("."+c.data.id).offset().top-$("video").offset().top)/$("video").height()*100;f>50?$("."+c.data.id+" .input-wraper").addClass("left").removeClass("right"):$("."+c.data.id+" .input-wraper").addClass("right").removeClass("left"),g>50?$("."+c.data.id+" .input-wraper").addClass("bottom").removeClass("top"):$("."+c.data.id+" .input-wraper").addClass("top").removeClass("bottom");$("."+c.data.id+" .remove-btn").hide().click(function(a){$("."+c.data.id+" .input-wraper").hide(),vi2.observer.player.play()}),$("."+c.data.id+" .save-btn").bind("click",{},function(a){var b={type:d.name,id:c.data.id,date:c.data.date,author:vi2.wp_user,y:c.data.y,x:c.data.x,starttime:c.displayPosition.t1,duration:"10",markertype:"marker-label-desc",markerlabel:$(this).parent().find("#marker-text-label").val(),
markerselectoption:"cat a",markerdescription:$(this).parent().find("#marker-description").val(),markerdescription2:$(this).parent().find("#marker-description2").val()};d.updateDOMElement(b),vi2.observer.player.play()}),$("."+c.data.id).show();$(d.options.menuSelector+" li").each(function(a,b){$(this).removeClass("vi2-highlight")}),$(".t"+Number(c.displayPosition.t1.replace(".",""))).addClass("vi2-highlight")}},end:function(a,b,c){$("."+c.data.id).hide(),this.currentMarker=-1},createAnnotationForm:function(a){var b="\t\t\t<textarea name='analysis-entry' data-datatype='string' placeholder='' aria-describedby='analysis-form1'><%= content %></textarea>\t\t\t<br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='analysis-form1'>Zeitpunkt (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='analysis-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='analysis-form1'>\t\t\t</div>\t\t\t";return a?ejs.render(b,a):ejs.render(b,{content:"",time:vi2.observer.player.currentTime(),date:(new Date).getTime(),author:vi2.wp_user})},getAnnotationFormData:function(a){return{content:$(a).find('[name="analysis-entry"]').val(),time:$(a).find('[name="analysis-entry-time"]').attr("value")}}});var $=jQuery,ViLab=$.inherit({__constructor:function(a,b){var c=this;this.server_url=a,vi2=this,vi2.dom="#vi2";var d=new Vi2.Maintain;d.foo(),$.get("/json/user-data",function(a){$.get("/json/script",function(d){c.script=d,c.currentGroupVideoNum=d.phases[d.current_phase].groupindex,c.current_phase=d.current_phase,c.wp_user=a.id,c.dom=vi2.dom,c.loadedWidgets=[],c.init("startApp",b),$("#inte").remove(),socket.on("video.refresh.annotations",function(a){c.init("updateApp",b)})})})},json:"",current_phase:0,viLog:"",wp_user:"",author:"...",title:"...",source_selector:"#vi2",video_source:"",server_url:"",plugin_dir:"",widgets:{test:"bam",widgets:[{name:"tags"},{name:"highlight"},{name:"toc"},{name:"hyperlinks"},{name:"comments"},{name:"syncMedia"},{name:"assessment"},{name:"assessment-fill-in"},{name:"assessment-writing"}]},widgetOptions:{},ajaxurl:"",userData:{},observer:"",videoData:{},currentVideo:"",currentGroupVideoNum:1,phase:{grouplevel:1},videoJSON:{},db:{},loadedWidgets:[],init:function(a,b){this.currentVideo=b;var c=[{path:this.server_url+"/json/videos/"+b,storage:"json_data"},{path:this.server_url+"/groups",storage:"json_group_data"},{path:this.server_url+"/json/users",storage:"json_user_data"}];vi2.db=new Vi2.DataBase({path:"",jsonFiles:c},this,a,void 0)},log:function(a){$(this).trigger("log",[a])},viLog:{},startApp:function(){var a=this;$(vi2.dom).empty(),$("#seq").empty(),$("#screen").empty(),$("#accordion").empty(),this.userData=this.db.getUserById(this.wp_user),this.currentGroup=this.userData.groups[this.currentGroupVideoNum],this.groupData=this.db.getGroupById(this.currentGroup),this.videoData=this.db.getStreamById(this.currentVideo);$("<div></div>").attr("type","video").attr("starttime",0).attr("duration",7).attr("id","myvideo").text(this.videoData.video).appendTo(vi2.dom);this.loadedWidgets=[],$("#overlay").empty(),$("body").find(".ui-dialog").each(function(a,b){$(this).remove()}),$("body").find(".some-dialog").each(function(a,b){$(this).remove()}),this.viLog=new Vi2.Log({logger_path:this.server_url+"/log"}),$(this).bind("log",function(b,c){a.viLog.add(c)}),vi2.utils=new Vi2.Utils,this.setupVideo(1)},updateApp:function(){var a=this;$.each(this.loadedWidgets,function(b,c){a.loadedWidgets[b]="",a.enableWidget(c,a.widgetOptions[c],{refresh:!0})}),this.observer.setAnnotations()},script:{},setupVideo:function(a){var b=this,c=b.db.hasSlides(b.currentVideo),d={id:b.currentVideo,embed:!1,selector:0===c?"#seq":"#screen",videoWidth:1===c?28:900,videoHeight:1===c?15:450,markupType:"html",thumbnail:b.db.getMetadataById(b.currentVideo).thumbnail[2]};$("#overlay").css("width",$(".slide").width()),$("#overlay").css("height",$(".slide").height()),$(window).resize(function(){setTimeout(function(){$("#overlay").css("width",$(".slide").width()),$("#overlay").css("height",$(".slide").height())},120)});var e=0,f=window.location.href.slice(window.location.href.indexOf("#!")+1);f=f.substr(1,f.length),"t=npt:"==f.substr(0,6)&&(e=f.split("t=npt:")[1].split(",")[0]),b.observer=new Vi2.Observer(d),b.observer.init(e),b.observer.addWidget(b.viLog),this.current_phase="üüü"===b.userData.experimental?4:this.script.current_phase,$.each(this.script.phases[this.current_phase].widgets,function(a,c){b.enableWidget(c.name,c),b.widgetOptions[c.name]=c}),b.observer.parse(vi2.dom,"html"),vi2.observer.player.video.oncanplay=function(a){vi2.observer.player.play()};this.script.phases[(""+b.db.getStreamById(b.currentVideo).id)[0]];$("#accordion").accordion({collapsible:!1,heightStyle:"fill"});var g={toc:{type:"toc",title:"Kapitelmarke hinzufügen",tooltip:"Kapitel hinzufügen"},comments:{type:"comments",title:"Kommentar hinzufügen",tooltip:"Kommentar hinzufügen"},hyperlinks:{type:"hyperlinks",title:"Link hinzufügen",tooltip:"Link hinzufügen"},assessment:{type:"assessment",title:"Aufgabe hinzufügen",tooltip:"Aufgabe hinzufügen"}};$("#myModal").on("hide.bs.modal",function(a){b.observer.player.isPlaying()===!1&&b.observer.player.play(),$("body").unbind("keydown").bind("keydown",function(a){vi2.observer.player.keyboardCommandHandler(a)})}),$("#myModal").on("show.bs.modal",function(a){b.observer.player.isPlaying()&&b.observer.player.pause(),$("body").unbind("keydown");var c=$(a.relatedTarget),d=c.data("annotationtype"),e=c.data("annotationdata"),f=$(this),h=vi2.observer.widget_list[d];f.find(".modal-title").html(g[d].title),f.find(".modal-validation").empty(),$.isEmptyObject(e)?(vi2.observer.log({context:d,action:"open-form-new-annotation",values:[vi2.wp_user]}),f.find(".modal-body").html(h.createAnnotationForm({content:"",time:vi2.observer.player.currentTime()})),f.find(".btn-remove-data").hide()):0===e.content.length?(vi2.observer.log({context:d,action:"open-form-reply-annotation",values:[e.author]}),f.find(".modal-body").html(h.createAnnotationForm({content:"",time:e.time})),f.find(".btn-remove-data").hide()):(vi2.observer.log({context:d,action:"open-form-edit-annotation",values:[e.author]}),f.find(".modal-body").html(h.createAnnotationForm(e)),f.find(".btn-remove-data").show()),f.find(".btn-sava-data").unbind("click"),f.find(".btn-sava-data").click(function(a){var c=h.validateAnnotationForm(f.find(".modal-body"),d),g=h.getAnnotationFormData(f.find(".modal-body"));0===c.length?($.isEmptyObject(e)||0===e.content.length?(vi2.observer.log({context:d,action:"added-new-annotation",values:[vi2.wp_user]}),h.addDOMElement({type:d,date:(new Date).getTime(),time:g.time,content:g.content})):(vi2.observer.log({context:d,action:"updated-annotation",values:[e.author]}),h.updateDOMElement({date:e.date,time:g.time,content:g.content})),b.savePopcorn(d),b.observer.player.isPlaying()===!1&&b.observer.player.play(),f.modal("hide")):f.find(".modal-validation").html(c)}),f.find(".btn-remove-data").unbind("click"),f.find(".btn-remove-data").click(function(a){"tags"==d||"highlight"==d?$(vi2.dom).find(':contains("'+e.content+'")').each(function(a,b){$(this).remove()}):$(vi2.dom).find('[date="'+e.date+'"]').remove(),b.savePopcorn(d),vi2.observer.log({context:d,action:"removed-annotation",values:[e.author]}),b.observer.player.isPlaying()===!1&&b.observer.player.play(),f.modal("hide")})})},enableWidget:function(a,b,c){var d=this,e="",f=a;if(this.loadedWidgets.indexOf(a)==-1){switch(a){case"toc":e=new Vi2.TableOfContents(b.widget_options),f="Kapitel";break;case"hyperlinks":e=new Vi2.Hyperlinks(b.widget_options),f="Links";break;case"comments":e=new Vi2.Comments(b.widget_options),f="Kommentare";break;case"assessment":e=new Vi2.Assessment(b.widget_options),f="Testfragen";break;case"assessmentanalysis":e=new Vi2.Analysis(b.widget_options),f="Analyse";break;case"syncMedia":var g=vi2.db.getStreamById(d.currentVideo).id,h=[20,22,24,26,28,30];h.indexOf(Number(g))===-1&&(e=new Vi2.SyncronizeMedia(b.widget_options),f="Folien");break;case"tags":e=new Vi2.TemporalTags({hasTimelineMarker:!0,max:20},{}),f="Tags";break;case"highlight":e=new Vi2.VisualHighlighting,f="Darsteller";break;case"assessment-fill-in":e=new Vi2.AssessmentFillIn({target_selector:"#seq",vizOnTimeline:!0,minDuration:"5"}),f="Lückenskript";break;case"assessment-writing":e=new Vi2.AssessmentWriting({target_selector:"#seq",vizOnTimeline:!0,minDuration:"5"}),f="Aufgaben";break;default:return}if(""!==e&&(this.observer.addWidget(e),this.loadedWidgets.push(a)),b.widget_options.hasMenu&&!c){var i=$('<h3 class="ui-accordion-header ui-corner-all"></h3>').append('<a class="accordion-title" href="#">'+f+"</a>").appendTo("#accordion");if(b.canBeAnnotated){$("<span></span>").addClass("glyphicon glyphicon-plus add-btn add-btn-"+a).attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype",a).attr("title","Neu hinzufügen").appendTo(i)}$("<div></div>").attr("id",a).appendTo("#accordion")}}},savePopcorn:function(a){var b=this,c=this.vitwo2json(a);$.post("/videos/annotate",{data:c,annotationtype:a,videoid:b.videoData._id},function(a){socket.emit("video.updated",{videoid:b.videoData._id}),b.observer.setAnnotations()})},vitwo2json:function(a){var b=[];switch(a){case"tags":var c=[];$(vi2.dom).find("div[type='tags']").each(function(a,b){var d=0;$.each(c,function(a,c){this.tagname==encodeURIComponent($(b).text())&&(this.occ.push(Number($(b).attr("starttime"))),d=1)})}),r=c;break;case"highlight":$(vi2.dom).find("div[type='highlight']").each(function(a,c){var d=0;$.each(highlight,function(a,b){this.tagname==encodeURIComponent($(c).text())&&(this.occ.push(Number($(c).attr("starttime"))),d=1)}),0==d&&b.push(JSON.parse('{"tagname":"'+encodeURIComponent($(c).text())+'", "occ":['+Number($(c).attr("starttime"))+"] }"))});break;case"toc":$(vi2.dom).find("div[type='toc']").each(function(a,c){b.push(JSON.parse('{"label":"'+encodeURIComponent($(this).text())+'", "start":"'+$(this).attr("starttime")+'", "author":"'+$(this).attr("author")+'", "date":"'+$(this).attr("date")+'" }'))});break;case"comments":$(vi2.dom).find("div[type='comments']").each(function(a,c){b.push(JSON.parse('{"comment":"'+encodeURIComponent($(this).text())+'", "start":"'+$(this).attr("starttime")+'", "author":"'+$(this).attr("author")+'", "date":"'+$(this).attr("date")+'"}'))});break;case"hyperlinks":$(vi2.dom).find("div[type='hyperlinks']").each(function(a,c){b.push({type:"hyperlinks",author:$(c).attr("author"),date:$(c).attr("date"),target:$(c).attr("target"),title:encodeURIComponent($(c).text()),description:encodeURIComponent($(c).attr("description")),starttime:$(c).attr("starttime"),duration:$(c).attr("duration"),x:$(c).attr("posx"),y:$(c).attr("posy"),seek:$(c).attr("seek"),duration2:$(c).attr("duration2")})});break;case"assessment":$(vi2.dom).find("div[type='assessment']").each(function(a,c){b.push({type:"assessment",title:$(c).data("task"),starttime:$(c).attr("starttime"),start:$(c).attr("starttime"),time:$(c).attr("starttime"),author:$(c).attr("author"),date:$(c).attr("date")})})}return b},getWidgets:function(){return!0}});