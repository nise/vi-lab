Vi2.Assessment=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"assessment",type:"annotation",options:{displaySelector:"#overlay",hasTimelineMarker:!0,timelineSelector:".vi2-timeline-top",hasMenu:!0,menuSelector:"#assessment",allowComments:!0,allowEditing:!0,allowCreation:!0,path:"/static/img/user-icons/"},init:function(a){var b=[];$.each(a,function(a,c){"assessment"===c.type&&""!==c.title&&b.push({name:c.title,occ:[c.t1],time:[c.t1],author:c.author,
date:c.date})});this.options.hasMenu&&this.createMenu(b);this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("assessment",b,this.options.timelineSelector)},createMenu:function(a){var b=this;$(this.options.menuSelector).empty();var e=$("<ul></ul>").addClass("assessment-list").appendTo(this.options.menuSelector);$.each(a,function(a,f){var g=vi2.db.getUserById(f.author),h=$("<span></span>").addClass("assessment-header");$("<span></span>").text(g.username).addClass("assessment-user").appendTo(h);
h.append(" "+moment(Number(f.date),"x").fromNow());g=new Image;$(g).addClass("assessment-user-icon");g=$("<a></a>").append(f.name.question).attr("author",f.author).addClass("id-"+f.time+" assessment-menu-question").click(function(){vi2.observer.log({context:"assessment",action:"menu-click",values:[f.name.question,f.author,f.time]});vi2.observer.player.currentTime(f.time)});$("<li></li>").attr("id","t"+f.time).attr("author",f.author).addClass("list-item").html(h).append(g).appendTo(e);b.options.allowEditing&&
Number(f.author)===Number(vi2.wp_user)&&$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-pencil").attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","assessment").data("annotationdata",{content:f.name,time:f.time[0],date:f.date,author:f.author}).appendTo(h)});e.find("li").tsort({attr:"id"})},appendToDOM:function(a){$(vi2.dom).find('[type="assessment"]').each(function(a,e){$(this).remove()});$.each(vi2.db.getAssessmentById(a),function(a,e){$("<div></div>").attr("type",
"assessment").attr("starttime",e.start).attr("duration",10).attr("author",e.author).attr("date",e.date).attr("id","assessment-"+a).data("task",e.title).appendTo(vi2.dom)})},updateDOMElement:function(a){$(vi2.dom).find('[date="'+a.date+'"]').attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",a.time).data("task",a.content)},addDOMElement:function(a){$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",a.time).data("task",
a.content).appendTo(vi2.dom)},begin:function(a,b,e){$("body").unbind("keydown");var c=this,f="vi2assessment"+b;vi2.observer.player.pause();vi2.observer.log({context:"assessment",action:"display-question",values:[encodeURIComponent(e.content.title.question),e.author,vi2.observer.player.currentTime()]});a=$("<div></div>").attr("id","vi2assessment").addClass(f).html("").show();b=$("<h3></h3>").text("Testfrage");var g=$("<div></div>").addClass("assessment-question").text(""+e.content.title.question),
h=$("<div></div>").addClass("assessment-answers");0<e.content.title.answ.length&&(1===e.content.title.answ.length&&"fi"===e.content.title.answ[0].questiontype?$("<div></div>").attr("id","answ0").addClass("assessment-answer").append('<textarea name="quest"></textarea>').append("<br/>").appendTo(h):$.each(e.content.title.answ,function(a,b){$("<div></div>").attr("id",b.id).addClass("assessment-answer").append($('<input type="checkbox" name="quest" value="1" />').attr("id",b.id)).append(b.answ).click(function(){$(this).find('input[type="checkbox"]').trigger("click")}).append("<br/>").appendTo(h)}));
var k=$("<button></button>").addClass("btn btn-default assessment-btn").text("abschicken").click(function(){$(this).hide();c.evaluateAnswer("."+f,e.content.title,e.author)});$(a).append(b).append(g).append(h).append(k);$(this.options.displaySelector).append(a)},end:function(a,b){$(".vi2assessment"+b).remove()},createAnnotationForm:function(a){""===a.content&&(a={time:vi2.observer.player.currentTime(),date:(new Date).getTime(),author:vi2.wp_user,content:{question:"",answ:[],correct:[],time:vi2.observer.player.currentTime(),
date:(new Date).getTime()}});var b=$("<textarea></textarea>").attr("id","annotationQuestion").val(a.content.question),e=$("<div></div>").attr("id","answerbox"),c=0,f=$("<div></div>").append($("<span></span>").addClass("glyphicon glyphicon-plus ")).addClass("mc-question add-btn").append(" Multiple-Choice-Antwort hinzuf\u00fcgen").click(function(){var a=$("<span></span>").addClass("close-btn glyphicon glyphicon-remove-circle").attr("title","Antwortoption entfernen").click(function(){$(this).parent().remove();
$(".answer");$(".fi-question").show();$(".mc-question").show()});$(".fi-question").hide();var b="answ"+Math.ceil(100*Math.random()),a=$("<div></div>").attr("id",b).addClass("answer").append('<input id="'+b+'" type="checkbox" title="Setze ein H\u00e4ckchen f\u00fcr richtige L\u00f6sungen" name="quest" value="1" />').append('<input id="'+b+'" type="text" class="mc-option" value=""/>').append(a).append("<br/>");c++;e.append(a)}),g=$("<div></div>").append($("<span></span>").addClass("glyphicon glyphicon-align-left")).addClass("fi-question  add-btn").append(" Freitext-Antwort hinzuf\u00fcgen").click(function(){var a=
$("<span></span>").addClass("close-btn glyphicon glyphicon-remove-circle").attr("title","L\u00f6sung entfernen").click(function(){$(this).parent().remove();0===$(".answer").length?($(".fi-question").show(),$(".mc-question").show()):($(".fi-question").hide(),$(".mc-question").hide())});$(".mc-question").hide();$(".fi-question").hide();a=$("<div></div>").attr("id","answ"+Math.ceil(100*Math.random())).addClass("answer fi-answer").append($("<label></label>").text("L\u00f6sung:")).append("<textarea></textarea>").append(a).append("<br/>");
c++;e.append(a)});if(0<a.content.answ.length)if("mc"===a.content.answ[0].questiontype)$.each(a.content.answ,function(b,c){var f=$("<span></span>").addClass("close-btn glyphicon glyphicon-remove-circle").attr("title","Antwortoption entfernen").click(function(){$(this).parent().remove();0===$(".answer").length?($(".fi-question").show(),$(".mc-question").show()):($(".fi-question").hide(),$(".mc-question").hide())}),g=$('<input type="checkbox" title="Setze ein H\u00e4ckchen f\u00fcr richtige L\u00f6sungen" name="quest" value="1" />').attr("id",
c.id);-1!==a.content.correct.indexOf(c.id)&&g.attr("checked",!0);$("<div></div>").attr("id",c.id).addClass("answer").append(g).append($('<input type="text" class="mc-option" />').attr("id",c.id).val(c.answ)).append(f).append("<br/>").appendTo(e)});else if("fi"===a.content.answ[0].questiontype){var h=$("<span></span>").addClass("close-btn glyphicon glyphicon-remove-circle").attr("title","L\u00f6sung entfernen").click(function(){$(this).parent().remove();0===$(".answer").length?($(".fi-question").show(),
$(".mc-question").show()):($(".fi-question").hide(),$(".mc-question").hide())});$("<div></div>").attr("id","answ"+Math.ceil(100*Math.random())).addClass("answer fi-answer").append($("<label></label>").text("L\u00f6sung:")).append($("<textarea></textarea>").val(a.content.answ[0].answ)).append(h).append("<br/>").appendTo(e)}h="\t\t\t\t<div class='input-group'>\t\t\t\t\t<span class='input-group-addon' id='hyperlinks-form3'>Zeitpunkt (s)</span>\t\t\t\t\t<input type='text' class='form-control' value='"+
a.time+"' name='assessment-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t\t</div>";b=$("<div></div>").addClass("questionanswers").append($("<label></label>").text("Frage:")).append(b).append(e).append(f).append(g).append(h);void 0!==a.content.answ&&(void 0!==a.content.answ[0]&&"mc"===a.content.answ[0].questiontype&&g.hide(),void 0!==a.content.answ[0]&&"fi"===a.content.answ[0].questiontype&&(f.hide(),g.hide()));return b},validateAnnotationForm:function(a,
b){var e=0,c=0,f="";$(a).find("#annotationQuestion").each(function(a,b){2>String($(b).val()).length?($(b).addClass("validation-conflict"),e=!0):$(b).removeClass("validation-conflict")});e&&(f+="<br> Definieren Sie bitte einen Text f\u00fcr diese Frage.");0===$("#answerbox").find("div").length?f+="<br> Bitte definieren Sie f\u00fcr diese Frage entsprechende Antwortoptionen oder L\u00f6sungen.":($("#answerbox").find("textarea").each(function(a,b){2>String($(b).val()).length?($(b).addClass("validation-conflict"),
e=!0):$(b).removeClass("validation-conflict")}),e&&(f+="<br> Definieren Sie bitte die L\u00f6sung zu der Frage."),$("#answerbox").find("input[type=text]").each(function(a,b){""===$(b).val()?($(b).addClass("validation-conflict"),c=!0):$(b).removeClass("validation-conflict")}),c&&(f+="<br> Versehen Sie bitte jede Antwortoption mit einem Text."),0<$("#answerbox").find("input[type=checkbox]").length&&0===$("#answerbox").find("input:checked").length?($("#answerbox").find("input[type=checkbox]").addClass("validation-conflict"),
f+="<br> Mindestens eine Antwortoption sollte als richtig markiert werden."):$("#answerbox").find("input[type=checkbox]").removeClass("validation-conflict"));0!==String(f).length&&console.log("Validation Error:"+f);return f},getAnnotationFormData:function(a){var b={time:$(a).find('[name="assessment-entry-time"]').val(),content:{question:$("#annotationQuestion").val(),time:$("#annotationTime").attr("value"),date:String((new Date).getTime()),answ:[],correct:[]}};$("#answerbox").find("textarea").each(function(a,
c){b.content.answ[a]={id:$(c).attr("id"),answ:$(c).val(),questiontype:"fi"}});$("#answerbox").find("input[type=text]").each(function(a,c){b.content.answ[a]={id:$(c).attr("id"),answ:$(c).val(),questiontype:"mc"}});$("#answerbox").find(":checked").each(function(a,c){b.content.correct.push($(c).attr("id"))});return b},evaluateAnswer:function(a,b,e){var c=!1,f=[];if("fi"===b.answ[0].questiontype)3<$(".assessment-answers").find("textarea").val().length&&(f.push(!0),vi2.observer.log({context:"assessment",
action:"submited-answer",values:[encodeURIComponent(b.question),e,vi2.observer.player.currentTime(),encodeURIComponent($(".assessment-answers").find("textarea").val())]}),$(a).append($("<p><strong>Vielen Dank f\u00fcr die Bearbeitung der Frage. Folgende Musterl\u00f6sung wurde f\u00fcr diese Frage hinterlegt:</strong></p>")).addClass("assessment-msg-correct"),$("<span></span>").text(b.answ[0].answ).addClass("correct-answ").appendTo(a));else{b.checked=[];$(".assessment-msg-warning").hide();$("div.assessment-answers").find("input[type='checkbox']:checked").each(function(a,
e){b.checked.push($(e).attr("id"));c=!0;-1<b.correct.indexOf($(e).attr("id"))?f.push(!0):f.push(!1)});if(!c)return $(a).append($("<p>Bitte w\u00e4hlen Sie eine Antwortoption</p>").addClass("assessment-msg-warning")),$(".assessment-btn").show(),!1;vi2.observer.log({context:"assessment",action:"submited-answer",values:[encodeURIComponent(b.question),e,vi2.observer.player.currentTime(),b.checked.toString()]});-1===f.indexOf(!1)?(vi2.observer.log({context:"assessment",action:"submited-correct-result",
values:[encodeURIComponent(b.question),e,vi2.observer.player.currentTime()]}),$(a).append($("<p>Ihre Antwort ist richtig.</p>").addClass("assessment-msg-correct"))):(vi2.observer.log({context:"assessment",action:"submited-incorrect-result",values:[encodeURIComponent(b.question),e,vi2.observer.player.currentTime()]}),$(a).append($("<p>Ihre Antwort ist leider falsch.</p>").addClass("assessment-msg-wrong")))}b.type=b.answ[0].questiontype;(new Date).getTime();encodeURIComponent(b.question);encodeURIComponent(b.question);
"mc"===b.type?encodeURIComponent(b.checked):encodeURIComponent($(".assessment-answers").find("textarea").val());$(a).append($("<button></button>").addClass("btn btn-default").text("Video fortsetzen").click(function(){$(a).remove();vi2.observer.log({context:"assessment",action:"continue-playback",values:[encodeURIComponent(b.question),e,vi2.observer.player.currentTime()]});vi2.observer.player.play();$("body").unbind("keydown").bind("keydown",function(a){vi2.observer.player.keyboardCommandHandler(a)})}))}});
Vi2.Comments=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"comments",type:"annotation",options:{hasTimelineMarker:!0,hasMenu:!0,menuSelector:"#comments",allowEmoticons:!0,allowReplies:!0,allowEditing:!0,allowCreation:!0,timelineSelector:".vi2-timeline-buttom",path:"/"},player:null,init:function(a){var b=this,e=[];$.each(a,function(a,f){f.type===b.name&&e.push({name:f.title,occ:[f.t1],time:[f.t1],date:f.date,author:f.author})});this.options.hasMenu&&
this.createMenu(e);this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("comments",e,this.options.timelineSelector)},createMenu:function(a){var b=this,e=-1,c=$("<ul></ul>").addClass("comments-list");$(this.options.menuSelector).html(c);a=a.sort(function(a,b){return Number(a.time)>Number(b.time)?1:-1});moment.locale("de");$.each(a,function(a,g){var h=$("<a></a>").text(g.name).addClass("id-"+g.time+" comments-menu-question").click(function(){vi2.observer.log({context:"comments",
action:"menu-click",values:[g.name,g.author,g.time[0]]});b.player.currentTime(g.time[0])});b.options.allowEmoticons&&h.emoticonize({});var k=vi2.db.getUserById(g.author),l=$("<span></span>").addClass("comments-header");$("<span></span>").text(k.username).addClass("comments-user").appendTo(l);l.append(" "+moment(Number(g.date),"x").fromNow());h=$("<li></li>").addClass("list-item").addClass("t"+g.time).attr("author",g.author).attr("date","d"+g.date).attr("id","t"+b.formatTime(g.time,"-")).html(l).append(h).appendTo(c);
Number(g.time)===Number(e)&&h.css({"margin-left":"15px"});b.options.allowEditing&&Number(g.author)===Number(vi2.wp_user)&&$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-pencil").attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","comments").data("annotationdata",{content:g.name,time:g.time,date:g.date,author:g.author}).appendTo(l);b.options.allowReplies&&$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-arrow-right").attr("data-toggle","modal").attr("data-target",
"#myModal").attr("data-annotationtype","comments").data("annotationdata",{content:"",time:g.time,date:(new Date).getTime()}).appendTo(l);e=g.time})},appendToDOM:function(a){$(vi2.dom).find('[type="comments"]').each(function(a,e){$(this).remove()});$.each(vi2.db.getCommentsById(a),function(a,e){$("<div></div>").attr("type","comments").attr("starttime",e.start).attr("duration",10).attr("author",e.author).attr("date",e.date).text(decodeURIComponent(e.comment)).appendTo(vi2.dom)})},updateDOMElement:function(a){$(vi2.dom).find('[date="'+
a.date+'"]').attr("author",vi2.wp_user).attr("date",a.date).attr("starttime",a.time).text(a.content)},addDOMElement:function(a){$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",a.time).text(a.content).appendTo(vi2.dom)},begin:function(a,b,e){if(this.currImgId==e.content.target)return!1;$(this.options.menuSelector+" li").each(function(a,b){$(this).removeClass("highcomment")});$(this.options.menuSelector+" li#t"+e.displayPosition.t1).addClass("highcomments")},
createAnnotationForm:function(a){return a?ejs.render("\t\t\t<textarea name='comments-entry' data-datatype='string' placeholder='' aria-describedby='comments-form1'><%= content %></textarea>\t\t\t<br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='comments-form1'>Zeitpunkt (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='comments-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='comments-form1'>\t\t\t</div>\t\t\t",
a):ejs.render("\t\t\t<textarea name='comments-entry' data-datatype='string' placeholder='' aria-describedby='comments-form1'><%= content %></textarea>\t\t\t<br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='comments-form1'>Zeitpunkt (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='comments-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='comments-form1'>\t\t\t</div>\t\t\t",{content:"",time:vi2.observer.player.currentTime(),
date:(new Date).getTime(),author:vi2.wp_user})},getAnnotationFormData:function(a){var b={};b.content=$(a).find('[name="comments-entry"]').val();b.time=$(a).find('[name="comments-entry-time"]').attr("value");return b}});
Vi2.Hyperlinks=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"hyperlinks",type:"annotation",options:{displaySelector:"#seq",hasTimelineMarker:!0,timelineSelector:".vi2-timeline-top",hasMenu:!0,menuSelector:"#hyperlinks",minDuration:5,allowEditing:!0,allowCreation:!0,path:"/static/img/user-icons/"},player:null,link_list:{},currLinkId:-1,init:function(a){this.clear();var b=[];$.each(a,function(a,c){("cycle"===c.linktype||"standard"===c.linktype)&&b.push({name:c.title,
occ:[c.t1],target:c.target,description:decodeURIComponent(c.description),time:[c.t1],duration:c.t2,x:c.x,y:c.y,date:c.date,author:c.author})});this.options.hasMenu&&this.createMenu(b);this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("hyperlinks",b,this.options.timelineSelector)},appendToDOM:function(a){$(vi2.dom).find('[type="hyperlinks"]').each(function(a,e){$(this).remove()});$(vi2.dom).find('[type="cycle"]').each(function(a,e){$(this).remove()});$.each(vi2.db.getLinksById(a),
function(a,e){$("<div></div>").attr("type",e.type).attr("starttime",e.starttime).attr("duration",e.duration).attr("posx",e.x).attr("posy",e.y).attr("seek",vi2.utils.deci2seconds(this.seek)).attr("duration2",vi2.utils.deci2seconds(this.duration2)).attr("target",e.target).attr("description",encodeURIComponent(e.description)).attr("author",e.author).attr("date",e.date).text(e.title).appendTo(vi2.dom)})},updateDOMElement:function(a){$(vi2.dom).find('[date="'+a.date+'"]').attr("author",vi2.wp_user).attr("date",
(new Date).getTime()).attr("starttime",a.time).attr("description",encodeURIComponent(a.content.description)).attr("duration",void 0===a.content.duration?"10":a.content.duration).attr("posx",void 0===a.content.x?"20":a.content.x).attr("posy",void 0===a.content.y?"80":a.content.y).attr("seek",0).attr("duration2",0).attr("target",a.content.target).text(a.content.label)},addDOMElement:function(a){$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",(new Date).getTime()).attr("starttime",
a.starttime).attr("duration",void 0===a.content.duration?"10":a.content.duration).attr("posx",void 0===a.content.x?"20":a.content.x).attr("posy",void 0===a.content.y?"80":a.content.y).attr("seek",0).attr("duration2",0).attr("target",a.content.target).attr("description",encodeURIComponent(a.content.description)).text(a.content.label).appendTo(vi2.dom)},createMenu:function(a){var b=this,e=$("<ul></ul>").addClass("hyperlinks-list");$(this.options.menuSelector).html(e);$.each(a,function(a,f){var g=$("<a></a>").text(decodeURIComponent(f.name)).addClass("id-"+
f.occ[0]).attr("href","#!/video/"+vi2.observer.current_stream+"/t=npt:"+f.occ[0]+""),h=vi2.db.getUserById(f.author),g=$("<li></li>").addClass("hyperlinks-"+f.occ[0]).attr("id",""+f.occ[0]).attr("title",h.username+", "+moment(Number(f.date),"x").fromNow()).html(g).appendTo(e),h={time:f.occ[0],date:f.date,author:f.author,content:{label:f.name,date:f.date,duration:f.duration,description:f.description,target:f.target,x:f.x,y:f.y,seek:0,duration2:0}};b.options.allowEditing&&$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-pencil tiny-edit-btn-"+
b.name).attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","hyperlinks").data("annotationdata",h).appendTo(g);g.click(function(){vi2.observer.log({context:"hyperlinks",action:"menu-click",values:[f.name,f.author,f.occ[0]]});vi2.observer.player.currentTime(f.occ[0]);b.currentTocElement=a})});e.find("li").tsort({attr:"id"})},begin:function(a,b,e){this.currLinkId=b;var c=this;a=$("<span></span>");e.content.target.match(RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi))?
(e.linktype="external",a.addClass("glyphicon glyphicon-share-alt")):(e.linktype="standard",a.addClass("glyphicon glyphicon-link"));$("<a></a>").text(" "+decodeURIComponent(e.content.title)).attr("id","ov"+b).attr("href",e.content.target).attr("title",decodeURIComponent(e.content.description)).addClass("overlay ov-"+b+" hyperlink-"+e.linktype).bind("click",function(a){vi2.observer.log({context:"hyperlinks",action:"link-"+e.linktype+"-click",values:[e.content.target,e.author,e.displayPosition.t1]});
switch(e.linktype){case "standard":return!0;case "external":return!0;case "cycle":a=e.content.target.replace(/\#!/,""),vi2.observer.setCurrentStream(a),a={title:"return to: "+e.content.title,target:String(c.player.url).replace(/.webm/,"").replace(/videos\/iwrm\_/,""),linktype:"standard",type:"xlink",x:2,y:93,t1:e.seek,t2:e.duration,seek:e.displayPosition.t1,duration:0},vi2.observer.vid_arr[0].annotation.push(a)}c.loadVideo(vi2.observer.vid_arr[0].url,e.seek);$(this).remove()}).prepend(a).appendTo(this.options.displaySelector).css({left:e.displayPosition.x+
"%",top:e.displayPosition.y+"%",position:"absolute"}).effect("highlight",2E3)},end:function(a,b){$(this.options.displaySelector+" .ov-"+b).hide()},clear:function(){$(this.options.displaySelector).html("");$(".vi2-video-seeklink").html("")},createAnnotationForm:function(a){return""!==a.content?(a.content.description=decodeURIComponent(a.content.description),a.content.label=decodeURIComponent(a.content.label),ejs.render("\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form1'>ULR</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.target %>' name='hyperlinks-entry-url' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form1'>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form1'>Bezeichner</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.label %>' name='hyperlinks-entry-label' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form12'>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form2'>Beschreibung</span>\t\t\t\t<textarea name='hyperlinks-entry-desc' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form2'><%= content.description %></textarea>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form3'>Zeitpunkt (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='hyperlinks-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Anzeigedauer (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.duration %>' name='hyperlinks-entry-duration' data-datatype='decimal-time' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Position x (%)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.x %>' name='hyperlinks-entry-x' data-datatype='number' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Position y (%)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.y %>' name='hyperlinks-entry-y' data-datatype='number' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t",
a)):ejs.render("\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form1'>ULR</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.target %>' name='hyperlinks-entry-url' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form1'>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form1'>Bezeichner</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.label %>' name='hyperlinks-entry-label' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form12'>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form2'>Beschreibung</span>\t\t\t\t<textarea name='hyperlinks-entry-desc' data-datatype='string' placeholder='' aria-describedby='hyperlinks-form2'><%= content.description %></textarea>\t\t\t</div><br>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form3'>Zeitpunkt (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='hyperlinks-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Anzeigedauer (s)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.duration %>' name='hyperlinks-entry-duration' data-datatype='decimal-time' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Position x (%)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.x %>' name='hyperlinks-entry-x' data-datatype='number' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='hyperlinks-form66'>Position y (%)</span>\t\t\t\t<input type='text' class='form-control' value='<%= content.y %>' name='hyperlinks-entry-y' data-datatype='number' placeholder='' aria-describedby='hyperlinks-form3'>\t\t\t</div>\t\t\t",
{content:{description:"",target:"",label:"",duration:10,x:50,y:50},time:vi2.observer.player.currentTime(),date:(new Date).getTime(),author:vi2.wp_user})},getAnnotationFormData:function(a){return{time:$(a).find('[name="hyperlinks-entry-time"]').attr("value"),content:{label:$(a).find('[name="hyperlinks-entry-label"]').val(),target:$(a).find('[name="hyperlinks-entry-url"]').val(),description:$(a).find('[name="hyperlinks-entry-desc"]').val(),duration:$(a).find('[name="hyperlinks-entry-duration"]').val(),
x:$(a).find('[name="hyperlinks-entry-x"]').val(),y:$(a).find('[name="hyperlinks-entry-y"]').val(),seek:0,duration2:0}}},loadVideo:function(a,b){this.player.loadVideo(a,b)},loadCycleVideo:function(a,b,e,c){this.player.loadCycleVideo(a,b,e,c)}});
Vi2.SyncronizeMedia=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"syncMedia",type:"annotation",options:{selector:".syncMedia",hasTimelineMarker:!0,controls:!0,timelineSelector:".vi2-timeline-main",hasMenu:!1,menuSelector:".synMediaMenu",prefix_path:"slides/",sync:!0,placeholder:"/static/img/placeholder.jpg"},tag_obj:[],currImgId:-1,init:function(a){var b=this;this.tag_obj=[];$.each(a,function(a,c){if("syncMedia"==c.type){var f=b.get_tag_by_name(c.title);
-1==f?b.tag_obj.push({tagname:c.title,path:c.target,occ:[{start:c.t1,duration:c.t2,xpos:c.x,ypos:c.y}]}):b.tag_obj[f].occ.push({start:c.t1,duration:c.t2,x:c.x,y:c.y})}});$(this.options.selector).html(new Image).addClass(this.options.childtheme);this.currImgId=-1;a=new Image;$(a).attr("src",this.options.placeholder).addClass("slide").unbind("click").appendTo(this.options.selector)},createMenu:function(){$(this.options.selector).empty();var a=$("<ul></ul>").addClass("highlight-list").appendTo(this.options.selector);
$.each(this.tag_obj,function(b,c){$("<li></li>").addClass("list-item").attr("id",c.tagname.replace(" ","--")).append($("<a></a>").attr("freq",c.occ.length).addClass("id-"+c.tagname.replace(" ","--")).text(c.tagname+" ").css("font-size",1>c.occ.length/10?c.occ.length/10+1+"em":2<c.occ.length/10?"2em":_freq/10+"em").bind("click",{tags:c},function(a){vi2.observer.player.currentTime(c.occ[0].start);vi2.observer.player.pause();$("#video1").addClass("split");$(".highlight-element").remove();var b=new Image;
$(b).attr("src",c.path).addClass("slide ov-").unbind("load").bind("load",function(a){$("#seq").find(".helper").remove();$("<div></div>").addClass("helper").append(b).appendTo("#seq")});vi2.observer.log({context:"syncMedia",action:"menu-click",values:[c.tagname,"",c.occ]})})).appendTo(a)});$(vi2.observer.player).on("player.play",function(a){$("#video1").removeClass("split");$("#seq").find(".helper").remove()});var b={};b.attr="freq"==this.options.sort?"freq":"";b.order="desc"==this.options.order?"desc":
"asc";a.find("a").tsort(b);$(a).find("li:gt("+(this.options.max-1)+") > a").hide()},appendToDOM:function(a){$(vi2.dom).find('[type="syncMedia"]').each(function(a,e){$(this).remove()});$.each(vi2.db.getSlidesById(a),function(a,e){$("<div></div>").attr("type","syncMedia").attr("starttime",e.starttime).attr("duration",e.duration).attr("id",e.id).attr("path",e.img).text(this.tagname).appendTo(vi2.dom)})},begin:function(a,b,e){this.options.sync&&this.placeMedia(a,b,e)},end:function(a,b){$(this.options.selector+
" .ov-"+b).remove()},placeMedia:function(a,b,e){if(this.currImgId==e.content.target)return!1;var c=this;this.currImgId=e.content.target;var f=new Image;$(f).attr("src",this.options.prefix_path+"/"+e.content.target).addClass("slide ov-"+b).css({height:"100vh"}).unbind("load").bind("load",function(a){$(c.options.selector).html(f);$("#overlay").css("width",$(".slide").width())})},get_tag_by_name:function(a){var b=-1;$.each(this.tag_obj,function(e,c){c.tagname==a&&(b=e)});return b},loadVideo:function(a,
b){vi2.observer.player.loadVideo(a,b)},width:function(){return this.width},height:function(){return this.height}});
Vi2.TableOfContents=$.inherit(Vi2.Annotation,{__constructor:function(a){this.options=$.extend(this.options,a)},name:"toc",type:"annotation",options:{hasTimelineMarker:!0,hasMenu:!0,menuSelector:"#toc",timelineSelector:".vi2-timeline-main",allowEditing:!0,allowCreation:!0,path:"/"},currentTocElement:0,elements:[],init:function(a){var b=this,e=[];$.each(a,function(a,f){f.type===b.name&&("missing"!==f.note&&b.elements.push(f.t1),e.push({name:f.title,note:f.note,occ:[f.t1],time:[f.t1],author:f.author,
date:f.date}))});this.options.hasMenu&&this.createMenu(e);this.options.hasTimelineMarker&&vi2.observer.player.timeline.addTimelineMarkers("toc",e,this.options.timelineSelector);vi2.observer.player.video.addEventListener("timeupdate",function(a){})},appendToDOM:function(a){var b=document.createDocumentFragment();$(vi2.dom).find('[type="toc"]').each(function(a,b){$(this).remove()});$.each(vi2.db.getTocById(a),function(a,c){var f=document.createElement("div");f.setAttribute("type","toc");f.setAttribute("note",
c.note);f.setAttribute("starttime",c.start);f.setAttribute("duration",10);f.setAttribute("author",c.author);f.setAttribute("date",c.date);var g=document.createTextNode(decodeURIComponent(c.label));f.appendChild(g);b.appendChild(f)});$(vi2.dom).append(b)},updateDOMElement:function(a){$(vi2.dom).find('[date="'+a.date+'"]').attr("author",vi2.wp_user).attr("date",a.date).attr("starttime",a.time).text(a.content)},addDOMElement:function(a){$("<div></div>").attr("type",a.type).attr("author",vi2.wp_user).attr("date",
(new Date).getTime()).attr("starttime",a.time).text(a.content).appendTo(vi2.dom)},begin:function(a,b,e){$(this.options.menuSelector+" li").each(function(a,b){$(this).removeClass("toc-highlight")});$(".toc-"+e.displayPosition.t1).addClass("toc-highlight")},end:function(a,b,e){},createMenu:function(a){var b=this,e=$("<ul></ul>").addClass("toc-list");$(this.options.menuSelector).html(e);$.each(a,function(a,f){var g=$("<a></a>").text(f.name).addClass("id-"+f.occ[0]+" toc-menu-link").attr("href","#!/video/"+
vi2.observer.current_stream+"/t=npt:"+f.occ[0]+""),h=vi2.db.getUserById(f.author),g=$("<li></li>").addClass("toc-"+f.occ[0]).attr("id","toc"+f.occ[0]).attr("title",h.username+", "+moment(Number(f.date),"x").fromNow()).html(g).appendTo(e);b.options.allowEditing&&$("<a></a>").addClass("tiny-edit-btn glyphicon glyphicon-pencil tiny-edit-btn-"+b.name).attr("data-toggle","modal").attr("data-target","#myModal").attr("data-annotationtype","toc").data("annotationdata",{content:f.name,time:f.occ[0],date:f.date,
author:f.author}).appendTo(g);"missing"===f.note?g.addClass("toc-disabled"):g.click(function(){vi2.observer.log({context:"toc",action:"menu-click",values:[f.name.replace(/,/g,"##"),f.author,f.occ[0]]});vi2.observer.player.currentTime(f.occ[0]);b.currentTocElement=a})})},createAnnotationForm:function(a){return a?ejs.render("\t\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='toc-form1'>Kapitelbezeichnung</span>\t\t\t\t<input type='text' class='form-control' value='<%= content %>' name='toc-entry' data-datatype='string' placeholder='' aria-describedby='toc-form1'>\t\t\t\t</div><br>\t\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='toc-form1'>Wiedergabezeit</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='toc-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='toc-form1'>\t\t\t\t</div>\t\t\t\t",
a):ejs.render("\t\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='toc-form1'>Kapitelbezeichnung</span>\t\t\t\t<input type='text' class='form-control' value='<%= content %>' name='toc-entry' data-datatype='string' placeholder='' aria-describedby='toc-form1'>\t\t\t\t</div><br>\t\t\t\t<div class='input-group'>\t\t\t\t<span class='input-group-addon' id='toc-form1'>Wiedergabezeit</span>\t\t\t\t<input type='text' class='form-control' value='<%= time %>' name='toc-entry-time' data-datatype='decimal-time' placeholder='' aria-describedby='toc-form1'>\t\t\t\t</div>\t\t\t\t",
{content:"",time:vi2.observer.player.currentTime(),author:vi2.wp_user,date:(new Date).getTime()})},getAnnotationFormData:function(a){var b={};b.content=$(a).find('[name="toc-entry"]').attr("value");b.time=$(a).find('[name="toc-entry-time"]').attr("value");return b},nextElement:function(){this.currentTocElement=this.currentTocElement<this.elements.length?this.currentTocElement+1:this.currentTocElement;vi2.observer.player.currentTime(this.elements[this.currentTocElement]);vi2.observer.log({context:"toc",
action:"jump-next",values:[this.currentTocElement]})},previousElement:function(){this.currentTocElement=0===this.currentTocElement?this.currentTocElement:this.currentTocElement-1;vi2.observer.player.currentTime(this.elements[this.currentTocElement]);vi2.observer.log({context:"toc",action:"jump-back",values:[this.currentTocElement]})}});
Vi2.AnnotatedTimeline=$.inherit({__constructor:function(a,b,e){this.video=a;this.options=$.extend(this.options,b);this.seek=void 0===e?0:e;this.init()},name:"annotated timeline",type:"core",options:{timelineSelector:".vi2-timeline-main",hasPreview:!1,hasSlidePreview:!1,previewPath:"/static/img/video-stills/theresienstadt/still-image-",hasMarker:!0,path:"/"},video:null,seek:0,seeksliding:!0,video_seek:null,video_loading_progress:null,video_timer:null,interval:0,percentLoaded:0,video_container:null,
cursorX:0,init:function(a){var b=this;this.video_seek=$(this.options.timelineSelector);this.video_loading_progress=$(".vi2-timeline-progress");this.video_timer=$(".vi2-video-timer");this.options.hasPreview&&this.createTimelineVideoPreview();this.options.hasSlidePreview&&this.createTimelineSlidePreview();var e=0,c=0;this.video.onloadstart=function(a){e=Date.now()};this.video.ondurationchange=function(){c=Date.now()-e;b.handleDurationChange()};this.video.onloadedmetadata=function(a){};this.video.onloadeddata=
function(a){vi2.observer.log({context:"player",action:"video-loading-time",values:[c,Date.now()-e]})};this.video.onprogress=function(a){};this.video.oncanplay=function(a){};this.video.oncanplaythrough=function(a){};this.video.addEventListener("timeupdate",function(a){b.handleTimeupdate(a)})},createTimelineControl:function(){var a=this;this.video.readyState?(clearInterval(this.interval),clearInterval(this.interval),this.video_seek.slider({value:0,step:0.01,orientation:"horizontal",range:"min",max:vi2.observer.player.duration(),
animate:!1,slide:function(b,e){a.seeksliding=!0},start:function(b,e){vi2.observer.log({context:"player",action:"seek-start",values:[e.value]});a.buffclick++;a.seeksliding=!0},stop:function(b,e){vi2.observer.log({context:"player",action:"seek-stop",values:[e.value]});a.seeksliding=!1;vi2.observer.player.currentTime(parseFloat(Math.ceil(e.value)))}})):this.interval=setInterval(function(){a.createTimelineControl()},150)},createTimelineVideoPreview:function(){var a=this,b=$(this.options.timelineSelector).width();
$(this.options.timelineSelector).offset();var e=1,c=null,f=new Image;f.id="videopreview";var g=$("<div></div>").addClass("vi2-timeline-preview").html(f).appendTo(a.options.timelineSelector),f=function(f){$(g).css({left:f.pageX-100});e=Math.round(f.pageX/b*vi2.observer.player.duration())-20;c=new Image;img_selector=document.getElementById("videopreview");listener=function(a){img_selector.src=c.src};c.removeEventListener("load",listener,!1);c.addEventListener("load",listener,!1);c.src=a.options.previewPath+
""+e+".jpg";c.onerror=function(){this.style.display="none"}},h=document.getElementsByClassName("vi2-timeline-main");h[0].removeEventListener("mousemove",f);h[0].addEventListener("mousemove",f)},createTimelineSlidePreview:function(){var a=this,b=$(this.options.timelineSelector).width();$(this.options.timelineSelector).offset();var e=1,c=null,f=$("<div></div>").addClass("vi2-timeline-preview").appendTo(this.options.timelineSelector);document.getElementsByClassName("vi2-timeline-main")[0].addEventListener("mousemove",
function(g){$(f).css({left:g.pageX-100});e=Math.floor(vi2.observer.player.duration()/b*Math.floor(g.pageX)).toString();c=new Image;c.src=a.options.previewPath+""+e+".png";listener=function(a){$(f).html(c)};c.removeEventListener("load",listener,!0);c.addEventListener("load",listener,!0)},!1)},addTimelineMarkers:function(a,b,e){var c=this;void 0===e&&(e=this.options.timelineSelector);this.options[a]={markerHasTooltip:!0,markerIsClickable:!0};var f=$(e);$("."+a+"-timeline-marker").each(function(a,b){$(b).remove()});
$.each(b,function(b,h){var k=h.occ[0]/vi2.observer.player.duration(),k=k*$(e).width();isNaN(k)||k>$(e).width()||(k=$("<a></a>").addClass(a+"-timeline-marker ttoc").attr("style","left:"+k+"px;"),c.options[a].markerHasTooltip&&k.attr("title",h.name).attr("data-toggle","tooltip"),c.options[a].markerIsClickable&&k.bind("click",function(b){vi2.observer.player.currentTime(h.occ[0]);vi2.observer.log({context:a,action:"timeline-link-click",values:[h.name,h.author,h.occ[0]]})}),f.append(k))})},handleDurationChange:function(a){this.createTimelineControl();
vi2.observer.player.currentTime(this.seek);$(vi2.observer).trigger("player.ready",[vi2.observer.player.seqList[vi2.observer.player.seqNum].id,vi2.observer.player.seqNum])},handleProgress:function(a){var b=this.video;percent=null;b&&b.buffered&&0<b.buffered.length&&b.buffered.end&&b.duration?percent=b.buffered.end(0)/b.duration:b&&void 0!==b.bytesTotal&&0<b.bytesTotal&&void 0!==b.bufferedBytes?percent=b.bufferedBytes/b.bytesTotal:a&&(a.lengthComputable&&0!==a.total)&&(percent=a.loaded/a.total);null!==
percent&&(this.percentLoaded=percent,percent=Math.min(1,Math.max(0,percent)),this.video_loading_progress&&this.video_seek&&this.video_loading_progress.width(this.video_seek.width()*percent))},handleTimeupdate:function(a){this.seeksliding||this.video_seek.slider("value",vi2.observer.player.currentTime())}});
Vi2.Annotation=$.inherit({__constructor:function(a){this.options=a},name:"annotation",type:"annotation",options:{},init:function(a){},appendToDOM:function(a){},begin:function(a,b,e){},end:function(a,b){},validateAnnotationForm:function(a,b){var e=0,c=0,f="";$(a).find("input[type=text]").each(function(a,b){""===$(b).val()?($(b).addClass("validation-conflict"),c=!0):$(b).removeClass("validation-conflict")});c&&(f+="\n Versehen Sie bitte die/das Textfeld/er mit einem Text.");$(a).find("textarea").each(function(a,
b){2>String($(b).val()).length?($(b).addClass("validation-conflict"),e=!0):$(b).removeClass("validation-conflict")});e&&(f+="\n Definieren Sie bitte einen Text f\u00fcr das Textfeld.");0<$(a).find("input[type=checkbox]").length&&0===$(a).find("input:checked").length?($(a).find("input[type=checkbox]").addClass("validation-conflict"),f=NaN):$(a).find("input[type=checkbox]").removeClass("validation-conflict");0!==String(f).length&&console.log("Validation Error:"+f);return f},formatTime:function(a,b){b=
b?b:"";var e=Math.round(a),c=Math.floor(e/60),e=Math.floor(e%60);return(10<=c?c:"0"+c)+b+(10<=e?e:"0"+e)}});
Vi2.Clock=$.inherit({__constructor:function(a,b){this.player=a;this.clockInterval=b},name:"clock",player:null,clockInterval:500,isRunning:!1,timelineSelector:"div.vi2-video-seek",interval:-1,annotations:[],hooks:[],isHook:function(a){return null!==this.hooks[a]},addHook:function(a,b){this.hooks[a]=b;return!0},addAnnotation:function(a){this.isHook(a.type)&&this.annotations.push({active:!1,author:a.author,width:a.width,content:{title:a.title,target:a.target,description:a.description,note:a.note},linktype:a.linktype,
type:a.type,displayPosition:{x:a.x,y:a.y,t1:a.t1,t2:a.t2},seek:a.seek,duration:a.duration})},checkAnnotation:function(){for(var a=this.parseTime(this.player.currentTime()),b=this.annotations.length,e=0;e<b;e++){var c=this.annotations[e];a>=c.displayPosition.t1&&a<Number(c.displayPosition.t1)+Number(c.displayPosition.t2)?c.active||(c.active=!0,$(this.player).trigger("annotation.begin."+c.type,[e,c])):(c.active=!1,$(this.player).trigger("annotation.end."+c.type,[e]))}},prepAnno:[],buildAnnotationIndex:function(){for(var a=
[],b=0;1E3>b;b++)a[b]=[];$.each(this.annotations,function(b,c){var f=1>c.displayPosition.t1?0:Math.ceil(c.displayPosition.t1/100);a[f].push(c)});this.prepAnno=a},checkAnnotation_new:function(){var a=this,b=this.parseTime(this.player.currentTime()),e=1>this.player.currentTime()?0:Math.ceil(b/100);$.each(a.prepAnno[e],function(c,e){b>=e.displayPosition.t1&&b<Number(e.displayPosition.t1)+Number(e.displayPosition.t2)?e.active||(e.active=!0,alert(e.type),$(a.player).trigger("annotation.begin."+e.type,
[c,e])):(e.active=!1,$(a.player).trigger("annotation.end."+e.type,[c]))})},startClock:function(){if(!this.isRunning){var a=this;this.isRunning=!0;this.interval=setInterval(function(){a.checkAnnotation()},this.clockInterval)}},stopClock:function(){clearInterval(this.interval);clearInterval(this.interval);this.isRunning=!1},reset:function(){$("#overlay").html("");this.annotations=[]},parseTime:function(a){return a},getCurrentTime:function(){return this.player.currentTime()}});
Vi2.DataBase=$.inherit({__constructor:function(a,b,e,c){this.call_back=b;var f=this;this.options=$.extend(this.options,a);this._d=0;$.each(this.options.jsonFiles,function(a,b){console.log("making requst for "+b.path);f.loadJSON(b.path,b.storage,e)})},name:"dataBase",options:{path:"",jsonFiles:[]},call_back:{},_d:0,json_data:{},json_slide_data:{},json_user_data:{},content_selector:"#content",dom:"#hydro1",loadJSON:function(a,b,e){var c=this;$.ajax({type:"get",beforeSend:function(a){a.overrideMimeType&&
a.overrideMimeType("application/json")},url:c.options.path+a,dataType:"json",success:function(a){c[b]=a;c._d++;c._d===Object.size(c.options.jsonFiles)&&(console.log("done"),c.call_back[e]())},error:function(a){window.location="/login"}})},isStream:function(a){var b=!1;$.each(this.json_data,function(e){this.id===a&&(b=!0)});return b},getStreamById:function(a){return void 0===this.json_data?{}:this.json_data},getAllCategories:function(){return this.json_data.categories},getCategoryTaxonomie:function(){var a=
{};$.each(this.json_data.categories,function(b,e){a[this.pos]={first_level:this.title,desc:this.desc}});return a},getCategory:function(a){var b={};$.each(this.json_data.categories,function(e,c){this.title===a&&(b={first_level:this.title,desc:this.desc,pos:this.pos,link:this.link,icon:this.icon})});return b},getMetadataById:function(a){return this.getStreamById(a).metadata[0]},getTitles:function(){var a=[];$.each(this.json_data,function(b){a.push({first_level:this.metadata[0].title})});return removeDuplicates(a)},
getAuthors:function(){var a=[];$.each(this.json_data,function(b){a.push({first_level:this.metadata[0].author})});return removeDuplicates(a)},getStreamsOfSameAuthor:function(a){var b=this.getMetadataById(a).author,e=[];$.each(this.json_data,function(c,f){f.metadata[0].author===b&&f.id!=a&&e.push(f.id)});return e},getTagsById:function(a){return void 0===this.json_data.tags?{}:this.getStreamById(a).tags},getCommentsById:function(a){return this.getStreamById(a).comments},getTagList:function(){var a=[];
$.each(this.json_data,function(b){$.each(this.tags,function(b){a.push({first_level:this.tagname})})});return this.removeDuplicates(a).sort()},getTagTaxonomie:function(){var a=[];$.each(this.json_data._taxonomy,function(b,e){a.push({first_level:this.id,second_level:this.sub})});return a},getStreamsWithSameTag:function(a){var b=this,e=[];a=this.getStreamById(a).tags;$.each(a,function(a,f){$.each(b.json_data,function(a,b){$.each(b.tags,function(a,c){this.tagname===f.tagname&&e.push(b.id)})})});return e},
getRandomStreams:function(a){var b=[];$.each(this.json_data,function(a,c){b.push(c.id)});return b},getLinkTargetsById:function(a){var b=[];$.each(this.getStreamById(a).hyperlinks,function(a){b.push(this.target)});return b},getLinkSourcesById:function(a){var b=[];$.each(this.json_data,function(e,c){$.each(c.hyperlinks,function(e,g){this.target===a&&b.push(c.id)})});return b},getLinksById:function(a){return this.getStreamById(a).hyperlinks},getAssessmentFillInById:function(a){return this.getStreamById(a).assessmentfillin},
getAssessmentWritingById:function(a){return this.getStreamById(a).assessmentwriting},getAssessmentById:function(a){return void 0===this.json_data.assessment?{}:this.json_data.assessment},getTocById:function(a){return void 0===this.json_data.toc?{}:this.getStreamById(a).toc},getHighlightById:function(a){return void 0===this.json_data.highlight?{}:this.getStreamById(a).highlight},getSlidesById:function(a){return this.getStreamById(a).slides},hasSlides:function(a){return void 0!==this.getStreamById(a).slides&&
0<this.getStreamById(a).slides.length?!0:!1},getUserById:function(a){var b={};$.each(this.json_user_data,function(e,c){Number(c.id)===Number(a)&&(b=c)});return b},getGroupById:function(a){var b={};$.each(this.json_group_data,function(e,c){Number(c.id)===Number(a)&&(b=c)});return b},getUserByGroupId:function(a,b){var e=[];$.each(this.json_user_data,function(c,f){f.groups[b]===a&&e.push(f)});return e},getVideoById:function(a){return $("<div></div>").attr("type","video").attr("starttime",0).attr("duration",
7).attr("id","myvideo").text(this.getStreamById(a).video)}});
Vi2.Log=$.inherit({__constructor:function(a){var b=this;this.options=$.extend(this.options,a);this.userAgent=this.getUserAgent();"-1"!==this.options.logger_path&&$.ajax({url:this.options.logger_path,success:function(a){b.ip=a.ip},dataType:"json"});$("#debug").html("")},name:"log",options:{output:"logfile",debug_selector:"#debug",prefix:"",logfile:"log.txt",parameter:"time,ip,msg,user",logger_path:"-1"},bucket:"",ip:"",init:function(){},add:function(a){if("string"===typeof a)console.log(a);else{console.log(a.context);
var b=vi2.observer.player.currentTime();t=new Date;t=t.getTime();a={utc:t,user:vi2.userData.id,video_id:vi2.currentVideo,action:a,playback_time:void 0===b?-1:b,user_agent:this.getUserAgent()};this.writeLog(a)}},getLogs:function(){return this.bucket},getLogTime:function(){var a=new Date,b=a.getSeconds(),e=a.getMinutes(),c=a.getHours(),f=a.getDate(),g=a.getMonth()+1,h=a.getFullYear();return{utc:a.getTime(),date:h+"-"+(9>=g?"0"+g:g)+"-"+(9>=f?"0"+f:f),time:(9>=c?"0"+c:c)+":"+(9>=e?"0"+e:e)+":"+(9>=b?
"0"+b:b)+":"+a.getMilliseconds()}},getIP:function(){return this.ip},getUserAgent:function(){return navigator.userAgent.replace(/,/g,";")},writeLog:function(a){"-1"!==this.options.logger_path&&$.post(this.options.logger_path,{data:a},function(a){})}});
Vi2.Metadata=$.inherit({__constructor:function(a){this.metadata=vi2.db.getMetadataById(vi2.observer.current_stream);this.options=$.extend(this.options,a);this.update()},options:{selector:".metadata",requiresMetatags:!0,requiresDisplay:!0},update:function(){this.options.requiresDisplay&&this.displayMetadata();this.options.requiresMetatags&&this.buildMetaTags()},displayMetadata:function(){},buildMetaTags:function(){$("head meta").each(function(a,b){this.remove()});$("head").prepend('<meta content="text/html;charset=utf-8" http-equiv="Content-Type">').prepend('<meta content="utf-8" http-equiv="encoding">').prepend('<meta itemprop="duration" content="'+
this.metadata.length+'" />').prepend('<meta itemprop="height" content="'+vi2.observer.player.height()+'" />').prepend('<meta itemprop="width" content="'+vi2.observer.player.width()+'" />').prepend('<meta itemprop="uploadDate" content="'+this.metadata.date+'" />').prepend('<meta itemprop="contentURL" content="'+vi2.db.getStreamById(vi2.observer.current_stream).video+'" />')}});
Vi2.Observer=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a);this.widget_list={};this.clock=new Vi2.Clock({},this.options.clockInterval)},name:"observer",options:{id:"start",embed:!0,selector:"#screen",clockInterval:500,videoSelector:"#video1",videoWidth:500,videoHeight:375,videoControlsSelector:".video-controls",markupType:"wiki",childtheme:""},pieList:$("<ul></ul>").attr("class","pieContextMenu").attr("id","menu"),player:void 0,clock:void 0,parseSelector:"",widget:void 0,
widget_list:[],hooks:[],vid_arr:[],current_stream:"start",seek:0,parser:"",setCurrentStream:function(a,b){this.current_stream=a;this.seek=b;$("<div></div>").attr("type","video").attr("starttime",0).attr("duration",7).attr("id","myvideo").text(vi2.db.getStreamById(a).video).appendTo("#vi2");this.clock.stopClock();this.clock.reset();new Vi2.Metadata;this.parse(vi2.dom,"html")},parse:function(a,b){this.parseSelector=a;this.parser=new Parser(a,null===b?this.markupType:b);this.vid_arr=[];this.vid_arr=
this.parser.run();this.clock.stopClock();this.clock.reset();this.player.loadSequence(this.vid_arr,0,this.seek)},init:function(a){a=void 0===a?0:a;var b=this,e=$("<video></video>").attr("controls",!1).attr("autobuffer",!0).attr("preload","metadata").attr("id",this.options.videoSelector.replace(/\#|./,"")).addClass("embed-responsive-item the-video").text("Your Browser does not support either this video format or videos at all");$(this.options.selector).addClass("embed-responsive embed-responsive-16by9").html(e);
this.player=new Video({embed:this.options.embed,selector:this.options.videoSelector,width:this.options.videoWidth,height:this.options.videoHeight,videoControlsSelector:this.options.videoControlsSelector,theme:this.options.theme,childtheme:this.options.childtheme,thumbnail:this.options.thumbnail,seek:a},this);this.clock.player=this.player;$(this).bind("player.ready",function(a,e,g){b.setAnnotations()})},setAnnotations:function(){var a=this;this.clock.annotations=[];this.vid_arr=this.parser.run();$.each(a.vid_arr[0].annotation,
function(b,e){a.clock.addAnnotation(e)});$.each(a.widget_list,function(b,e){"player-widget"!==e.type?e.init(a.vid_arr[0].annotation):e.init()})},updateLocation:function(a,b){window.location.replace(window.location.href.split("#")[0]+"#!"+a+":"+b.replace(/\ /g,"_"))},addWidget:function(a){a.player=this.player;this.clock.addHook(a.name,a);"annotation"===a.type&&(a.appendToDOM(this.current_stream),$(this.player).bind("annotation.begin."+a.name,function(b,e,c){a.begin(b,e,c)}),$(this.player).bind("annotation.end."+
a.name,function(b,e){a.end(b,e)}));switch(a.name){case "relatedVideos":$(this.player).bind("video.end",function(b,e){a.showLinkSummary()});break;case "log":$(this.player).bind("log",function(b,e){a.add(e)})}this.widget_list[a.name]=a;return!0},isWidget:function(a){return null!==this.widget_list[a]},getWidget:function(a){return this.widget_list[a]},removeWidget:function(a){this.widget_list[a]=0},annotationsToDOM:function(){var a=this;$.each(this.widget_list,function(b,e){"annotation"===e.type&&e.appendToDOM(a.current_stream)})},
ended:function(){},pause:function(){this.clock.stopClock()},play:function(){this.clock.startClock()},log:function(a){$(this.player).trigger("log",[a])},destroy:function(){$("video").stop();this.clock.reset();$("#vi2").empty()}});
var Parser=$.inherit({__constructor:function(a,b){this.selector=a;this.type=b},vid_arr:[],selector:"",run:function(){switch(this.type){case "wiki":return this.parseWiki();case "html":return this.parseHtml()}},parseWiki:function(){var a=this,b=-1;$(this.selector).val($(this.selector).val().replace(/\<p\>/,""));$($(this.selector+" > p").text().split(/\n/)).each(function(e,c){"[[Video:"==c.substr(0,8)||"[[video:"==c.substr(0,8)?(b++,a.vid_arr[b]=a.parseWikiVideo(c)):"[["==c.substr(0,2)&&a.vid_arr[b].annotation.push(a.parseWikiHyperlink(c))});
return this.vid_arr},parseHtml:function(){var a=this,b=-1,e=[],c={};$("div"+this.selector+" div").each(function(f,g){"video"==$(this).attr("type")?(e={},e.id=$(this).attr("id"),e.url=$(this).text(),e.seek=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),e.duration=void 0==$(this).attr("duration")?0:$(this).attr("duration"),e.annotation=[],b++,a.vid_arr[b]=e):"hyperlinks"==$(this).attr("type")?(c={},c.title=$(this).text(),c.description=$(this).attr("description"),c.target=$(this).attr("target"),
c.linktype="standard",c.type="hyperlinks",c.author=$(this).attr("author"),c.date=$(this).attr("date"),c.x=$(this).attr("posx"),c.y=$(this).attr("posy"),c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=void 0==$(this).attr("duration")?0:$(this).attr("duration"),c.seek=$(this).attr("seek"),c.duration2=$(this).attr("duration2"),c.target.match(/(^http:)(^https:)/)&&(c.linktype="external"),a.vid_arr[b].annotation.push(c)):"cycle"==$(this).attr("type")?(c={},c.title=$(this).text(),
c.target=$(this).attr("target"),c.description=$(this).attr("description"),c.linktype="cycle",c.type="hyperlinks",c.author=$(this).attr("author"),c.date=$(this).attr("date"),c.x=$(this).attr("posx"),c.y=$(this).attr("posy"),c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=void 0==$(this).attr("duration")?0:$(this).attr("duration"),c.seek=$(this).attr("seek"),c.duration=$(this).attr("duration2"),a.vid_arr[b].annotation.push(c)):"syncMedia"==$(this).attr("type")?(c={},c.title=
$(this).text(),c.target=$(this).attr("path"),c.linktype="",c.type="syncMedia",c.x=0,c.y=0,c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=void 0==$(this).attr("duration")?0:$(this).attr("duration"),a.vid_arr[b].annotation.push(c)):"map"==$(this).attr("type")?(c={title:""},c.target=$(this).text(),c.linktype="",c.type="map",c.x=0,c.y=0,c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=void 0==$(this).attr("duration")?0:$(this).attr("duration"),a.vid_arr[b].annotation.push(c)):
"toc"==$(this).attr("type")?(c={},c.title=$(this).text(),c.target=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.linktype="",c.type="toc",c.note=$(this).attr("note"),c.author=$(this).attr("author"),c.date=$(this).attr("date"),c.x=0,c.y=0,c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=1,a.vid_arr[b].annotation.push(c)):"tags"==$(this).attr("type")?(c={},c.title=$(this).text(),c.target=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.linktype=
"",c.type="tags",c.x=$(this).attr("posx"),c.y=$(this).attr("posy"),c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=void 0==$(this).attr("duration")?0:$(this).attr("duration"),a.vid_arr[b].annotation.push(c)):"highlight"==$(this).attr("type")?(c={},c.title=$(this).text(),c.target=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.linktype="",c.type="highlight",c.x=$(this).attr("posx"),c.y=$(this).attr("posy"),c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),
c.t2=void 0==$(this).attr("duration")?0:$(this).attr("duration"),a.vid_arr[b].annotation.push(c)):"comments"==$(this).attr("type")?(c={},c.title=$(this).text(),c.author=$(this).attr("author"),c.date=$(this).attr("date"),c.target=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.linktype="",c.type="comments",c.x=0,c.y=0,c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=1,a.vid_arr[b].annotation.push(c)):"assessment"==$(this).attr("type")?(c={},c.title=$(this).data("task"),
c.author=$(this).attr("author"),c.date=$(this).attr("date"),c.target=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.linktype="",c.type="assessment",c.x=0,c.y=0,c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=1,a.vid_arr[b].annotation.push(c)):"assessment-fill-in"==$(this).attr("type")?(c={},c.title=$(this).attr("id"),c.target=$(this).text(),c.linktype="standard",c.author=void 0==$(this).attr("author")?"":$(this).attr("author"),c.date=$(this).attr("date"),c.width=
void 0==$(this).attr("width")?100:$(this).attr("width"),c.type="assessment-fill-in",c.x=$(this).attr("posx"),c.y=$(this).attr("posy"),c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=void 0==$(this).attr("duration")?0:$(this).attr("duration"),c.seek=$(this).attr("seek"),c.duration=$(this).attr("duration2"),a.vid_arr[b].annotation.push(c)):"assessment-writing"==$(this).attr("type")&&(c={},c.title=encodeURIComponent($(this).text()),c.target=$(this).text(),c.linktype="standard",
c.author=void 0==$(this).attr("author")?"":$(this).attr("author"),c.width=void 0==$(this).attr("width")?100:$(this).attr("width"),c.type="assessment-writing",c.x=$(this).attr("posx"),c.y=$(this).attr("posy"),c.t1=void 0==$(this).attr("starttime")?0:$(this).attr("starttime"),c.t2=void 0==$(this).attr("duration")?0:$(this).attr("duration"),c.seek=$(this).attr("seek"),c.duration=$(this).attr("duration2"),a.vid_arr[b].annotation.push(c))});return a.vid_arr},parseWikiVideo:function(a){var b=[],e,c,f,g=
"_";a=a.replace(/^\[\[Video:/,"").replace(/\]\]/,"").replace(/\# /," #").replace(/\| /," |").replace(/  /," ");a=a.split(/ /);$.each(a,function(a,b){"#"==b.substr(0,1)?c=b.substr(1,b.length):"|"==b.substr(0,1)?f=b.substr(1,b.length):b.match(/(?=.ogg)/)?e=b:0<b.length&&(g=b)});b.id=g;b.url=e;b.seek=void 0==c?0:c;b.duration=void 0==f?0:f;b.annotation=[];return b},parseWikiHyperlink:function(a){var b="",b="",e={type:"hyperlinks",linktype:"standard"},b=RegExp(/^\[\[http:\/\//);a.match(b)?(b=RegExp(/\[\[http:\/\/[a-z A-Z 0-9 \#\ \_\/:.-]+/),
b=(new String(b.exec(a))).split(" "),e.target=b[0].replace(/^\[\[/,""),e.title=2<=b.length?b.slice(1):b[0].replace(/^[\[\[http:\/\/]/,""),e.title=(new String(e.title)).replace(/,/g," "),e.linktype="external"):(b=RegExp(/\[\[[a-z A-Z 0-9 \# \ \_\/\|:.-]+/),b=(new String(b.exec(a))).split(/\|/),e.target=b[0].replace(/^\[\[/,""),e.title=2<=b.length?b[1]:b[0].replace(/^\[\[/,""));var c=a.split(/\]/),b=RegExp(/[\ ]\#[0-9]+/);e.t1=a.match(b)?(new String(b.exec(c[1]))).replace(/[\#]/,""):0;b=RegExp(/[\ ]\|[0-9]+/);
e.t2=a.match(b)?(new String(b.exec(c[1]))).replace(/[\|]/,""):1E3;b=RegExp(/[\ ]+[0-9]{2}(?=\%)/g);b=a.match(b)?(new String(a.match(b))).split(/,/):[50,50];e.x=b[0]?b[0]:50;e.y=b[1]?b[1]:50;return e}});jQuery.fn.dropdown=function(a){var b=$(this).find("h4"),e=$(this).html();$(this).toggle(function(){$(this).html(b.wrapInner("<h4></h4>").html())},function(){$(this).html(e).find("h4").attr("style","background-image:url(images/arrow_d.png); display:inline;")}).click()};
jQuery.fn.hidetext=function(a){a=$(this).text();return $(this).text(a.substr(0,250)+" ").append($("<span>more</span>"))};jQuery.fn.round=function(a){a||(a=0);return Math.round(this*Math.pow(10,a))/Math.pow(10,a)};function delegate(a,b){var e=function(){return arguments.callee.func.apply(arguments.callee.target,arguments)};e.target=a;e.func=b;return e}function removeDuplicates(a){a=a.sort();for(var b=1;b<a.length;)a[b-1]==a[b]?a.splice(b,1):b++;return a}
function timeDifference(a,b,e){var c=moment(a);a=moment(a);var f=a.diff(c,"seconds");if(60>=f)return b+f.toFixed(1)+"s"+e;f=a.diff(c,"minutes");if(60>=f)return b+f.toFixed(1)+"min"+e;f=a.diff(c,"hours",!0);if(24>=f)return b+f.toFixed(1)+"h"+e;f=a.diff(c,"days",!0);if(30>f)return b+f.toFixed(1)+"d"+e;f=a.diff(c,"months",!0);if(12>f)return b+f.toFixed(1)+"m"+e;f=a.diff(c,"years",!0);return b+f.toFixed(1)+"y"+e}Object.size=function(a){var b=0,e={};for(e in a)a.hasOwnProperty(e)&&b++;return b};
Vi2.Utils=$.inherit({__constructor:function(a){},name:"utils",seconds2decimal:function(a){d=Number(a);a=Math.floor(d/3600);var b=Math.floor(d%3600/60),e=Math.floor(d%3600%60);return(0<a?a+":":"")+(0<b?(0<a&&10>b?"0":"")+b+":":"00:")+(10>e?"0":"")+e},deci2seconds:function(a){if(0>Number(a)||void 0===a)return 0;a=a.split(":");return 3600*Number(a[0])+60*Number(a[1])+Number(a[2])}});
Vi2.VideoManager=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a)},name:"video-manager",type:"collection",content_selector:"#content",options:{selector:"#seq"},viewing_history:[],init:function(){var a=this;Sammy(this.options.selector,function(){this.get("#!/video/:stream/:time",function(){a.handleNewStream(this.params)});this.get("#!/video/:stream",function(){a.handleNewStream(this.params)});this.get("#!/videos/all",function(){a.handleAllStreams()});this.get("#!/tags/:tag",
function(){a.handleTags(this.params)});this.get("#!/category/:category",function(){a.handleCategory(this.params)})}).run()},addRoute:function(a,b,e){Sammy(this.options.selector,function(){this.get("#!"+a,function(){b[e]()})}).run()},render:function(a,b){return(new EJS({url:vi2.templatePath+""+a})).render(b)},handleTags:function(a){a=a.tag.split(/,/);for(var b="",e=[],c=vi2.db.getInvertedTagIndex(),f=0;f<a.length;f++)void 0!==c[a[f]]&&(b+=c[a[f]].toString()+",");c=[];c=removeDuplicates(b.split(/,/));
for(b=0;b<c.length;b++)""!==c[b]&&(f=vi2.db.getStreamById(c[b]),e.push(f));a=this.render("vi2.video-manager.ejs",{title:"Tags: "+a.toString(),items:e});$(this.options.selector).html(a)},handleCategory:function(a){a=a.category;var b=vi2.db.getStreamsByCategory(a);a=this.render("vi2.video-manager.ejs",{title:"Category: "+a,items:b});$(this.options.selector).html(a)},handleAllStreams:function(a){a=vi2.db.getAllStreams();a=this.render("vi2.video-manager.ejs",{title:"Category: "+category,items:a});$(this.options.selector).html(a)},
handleNewStream:function(a){var b=void 0===a.time?0:a.time.split(/:/)[1];a.stream!=vi2.observer.current_stream?($(vi2.dom).empty(),vi2.observer.setCurrentStream(a.stream,b),vi2.observer.player.play(),this.loadWidgets()):vi2.observer.player.currentTime(b)},loadWidgets:function(){var a=new Vi2.TableOfContents({hasTimelineMarker:!0,hasMenu:!0,menuSelector:".toc"}),b=new Vi2.SyncronizeMedia({selector:".syncMedia",hasTimelineMarker:!0,hasMenu:!0,menuSelector:".toc"}),e=new Vi2.RelatedVideos({resultSelector:".related-videos",
criteria:[{criterion:"random-destructor",weight:0.1},{criterion:"same-author",weight:0.8},{criterion:"same-tags",weight:0.6},{criterion:"incomming-links",weight:0.5},{criterion:"outgoing-links",weight:0.5}]});new Vi2.Search({resultSelector:".search-results",limit:25});vi2.observer.addWidget(a);vi2.observer.addWidget(b);vi2.observer.addWidget(e)},listAllItems:function(){var a=$("#item_template").val();$.each(this.getCategoryTaxonomie(),function(b,e){$(_this.content_selector).append($("<h2></h2>").addClass("cat"+
b).text(e)).append("<br>");$.each(_this.json_data.stream,function(b,f){f.metadata[0].category==e&&$("<div></div>").setTemplate(a).processTemplate(f).appendTo($(_this.content_selector))})})}});
var Video=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a);this.spinner=new Spinner(this.spinner_options);this.video=document.getElementById(this.options.selector.replace(/\#/,""));this.loadUI()},name:"video player",options:{observer:null,selector:"#video1",width:500,height:375,seek:0,videoControlsSelector:".video-controls",thumbnail:"/static/img/placeholder.jpg",defaultVolume:0},video:null,timeline:null,observer:null,url:"",video_container:null,video_wrap:null,play_btn:null,
volume_btn:null,volume:null,isMuted:!1,isSequence:!1,seqList:[],seqNum:null,seqLoop:!1,videoIsPlaying:!0,percentLoaded:0,buffclick:0,spinner:!1,spinner_options:{lines:6,length:0,width:20,radius:20,color:"#003366",speed:1,trail:89,shadow:!1,hwaccel:!1,className:"spinner",zIndex:29,top:"auto",left:"auto"},loadVideo:function(a,b){var e=this;this.url=a;this.seek=void 0===b?0:b;var c=$("<video></video>").attr("controls",!1).attr("autobuffer",!0).attr("preload","metadata").attr("id","video1").addClass("embed-responsive-item").text("Your Browser does not support either this video format or videos at all");
$("#seq").addClass("embed-responsive embed-responsive-16by9").html(c);this.video=document.getElementById(this.options.selector.replace(/\#/,""));this.videoIsPlaying&&$(vi2.observer.player).trigger("player.play",[]);this.video.pause();this.startSpinning();c=this.detectVideoSupport();this.video=$.extend(this.video,{loop:!1,preload:"metadata",autoplay:this.videoIsPlaying,controls:!1,poster:"/static/img/placeholder.jpg",onerror:function(a){e.errorHandling(a)}});this.timeline=new Vi2.AnnotatedTimeline(this.video,
{},this.seek);this.logger();var f=new Vi2.PlaybackSpeed;vi2.observer.addWidget(f);f=new Vi2.SkipBack;vi2.observer.addWidget(f);this.play_btn=$(".vi2-video-play-pause");this.video.addEventListener("play",function(a){vi2.observer.clock.startClock();$("header").hide();e.play_btn.find(".glyphicon-pause").show();e.play_btn.find(".glyphicon-play").hide()});this.video.addEventListener("pause",function(a){vi2.observer.clock.stopClock();$("header").show();e.play_btn.find(".glyphicon-pause").hide();e.play_btn.find(".glyphicon-play").show()});
this.video.addEventListener("abort",function(a){vi2.observer.clock.stopClock();$("header").show();e.play_btn.find(".glyphicon-pause").hide();e.play_btn.find(".glyphicon-play").show()});this.video.addEventListener("readystate",function(a){e.readyStateHandler(a)});this.video.addEventListener("timeupdate",function(a){e.timeUpdateHandler(a)});this.video.addEventListener("ended",function(a){e.endedHandler(a)},!1);f=new Date;$(vi2.observer).trigger("stream.loaded",{stream:vi2.observer.current_stream,playback_time:b,
time:f.getTime()});void 0!==a&&$(this.video).html(this.createSource(a,c),this.video.firstChild)},detectVideoSupport:function(){var a=document.createElement("video");if(""!==a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'))return vi2.observer.log({context:"player",action:"video-support-mp4",values:["1"]}),"video/mp4";if(""!==a.canPlayType('video/webm; codecs="vp8, vorbis"'))return vi2.observer.log({context:"player",action:"video-support-webm",values:["1"]}),"video/webm";if(""!==a.canPlayType('video/ogg; codecs="theora, vorbis"'))return vi2.observer.log({context:"player",
action:"video-support-ogv",values:["1"]}),"video/ogv";vi2.observer.log({context:"player",action:"video-support-none",values:["1"]});$("#page").html('<h3>We appologize that video application is currently not supported by your browser.</h3>The provided video material can be played on Mozilla Firefox, Google Chrome and Opera. If you prefer Internet Explorer 9 you need to install a <a href="https://tools.google.com/dlpage/webmmf">webm video extension</a> provided by Google. In the near future we are going to server further video formats which will be supported by all major browsers.<br /><br /> Thank you for your understanding.');
return""},loadSequence:function(a,b,e){this.seqList=a;this.seek=e;this.isSequence=!0;this.seqNum=void 0===b?0:b;this.loadVideo(this.seqList[this.seqNum].url,this.seek)},createSource:function(a,b){var e=document.createElement("source");e.src=a+"?foo="+(new Date).getTime();e.type=b;return e},loadUI:function(){function a(){e=null;document.body.style.cursor="none";c=!1;$(b.options.videoControlsSelector).removeClass("open-controls")}var b=this;this.createPlaybackControl();this.createVolumeControl();this.createVideoHiding();
$(b.options.videoControlsSelector).addClass("open-controls");$("#video1, #overlay, #seq").hover(function(){$(b.options.videoControlsSelector).addClass("open-controls")},function(){$(b.options.videoControlsSelector).removeClass("open-controls")});var e=null,c=!0;document.getElementById("video1");document.onmousemove=function(){e&&window.clearTimeout(e);c||(document.body.style.cursor="default",c=!0,$(b.options.videoControlsSelector).addClass("open-controls"));e=window.setTimeout(a,1E3)};$("body").unbind("keydown").bind("keydown",
function(a){})},createPlaybackControl:function(){var a=this;this.play_btn=$(".vi2-video-play-pause");this.play_btn.bind("click",function(){a.play()});$(this.play_btn).bind("play",function(a){vi2.observer.play();$(".screen").remove()});$(this.play_btn).bind("pause",function(a){vi2.observer.pause()});$(vi2.observer.player).bind("player.play",function(a,e,c){$(".navbar").hide()});$(vi2.observer.player).bind("player.pause",function(a,e,c){$(".navbar").show()})},createVolumeControl:function(){var a=this;
this.volume=$(".vi2-volume-slider",this.video_container);this.volume_btn=$(".vi2-volume-button",this.video_container);$(this.volume).slider({orientation:"horizontal",range:"min",max:1,step:0.05,animate:!0,value:a.options.defaultVolume,slide:function(b,e){0<e.value&&0.5>e.value?(a.isMuted=!1,a.volume_btn.addClass("glyphicon-volume-down"),a.volume_btn.removeClass("glyphicon-volume-up"),a.volume_btn.removeClass("glyphicon-volume-off")):0.5<=e.value?(a.isMuted=!1,a.volume_btn.removeClass("glyphicon-volume-down"),
a.volume_btn.addClass("glyphicon-volume-up"),a.volume_btn.removeClass("glyphicon-volume-off")):(a.isMuted=!0,a.volume_btn.removeClass("glyphicon-volume-down"),a.volume_btn.removeClass("glyphicon-volume-up"),a.volume_btn.addClass("glyphicon-volume-off"))},change:function(b,e){a.video.volume=e.value;0<e.value&&0.5>e.value?(a.isMuted=!1,a.volume_btn.addClass("glyphicon-volume-down"),a.volume_btn.removeClass("glyphicon-volume-up"),a.volume_btn.removeClass("glyphicon-volume-off")):0.5<=e.value?(a.isMuted=
!1,a.volume_btn.removeClass("glyphicon-volume-down"),a.volume_btn.addClass("glyphicon-volume-up"),a.volume_btn.removeClass("glyphicon-volume-off")):(a.isMuted=!0,a.volume_btn.removeClass("glyphicon-volume-down"),a.volume_btn.removeClass("glyphicon-volume-up"),a.volume_btn.addClass("glyphicon-volume-off"))}});this.volume_btn.bind("click",function(b){a.muteVolume()});0===this.volume.slider("value")?(this.isMuted=!0,this.volume_btn.addClass("glyphicon glyphicon-volume-off")):this.volume_btn.addClass("glyphicon glyphicon-volume-up")},
getVolume:function(){return this.volume.slider("value")},setVolume:function(a){vi2.observer.log({context:"player",action:"set-volume",values:[a]});this.volume.slider("value",a)},increaseVolume:function(){$(this.volume).slider("value",$(this.volume).slider("value")+0.05)},decreaseVolume:function(){$(this.volume).slider("value",$(this.volume).slider("value")-0.05)},tmp_volume:0,muteVolume:function(){this.isMuted?(this.setVolume(tmp_volume),this.isMuted=!1):(tmp_volume=this.volume.slider("value"),this.setVolume(0),
this.isMuted=!0)},createVideoHiding:function(){var a=new Image;$(a).attr("src",this.options.thumbnail).addClass("toggle-pair").prependTo("#screen").hide();$(this.video).addClass("toggle-pair");var b=!0;$("<span></span>").addClass("toggle-moving-picture").text("hide video").prependTo("#screen").click(function(){$(this).text(b?"show video":"hide video");b=!b;$("#screen").find(".toggle-pair").toggle()});$("#screen").find(".toggle-pair").toggle().hide();$(".toggle-moving-picture").hide()},startSpinning:function(){this.spinner.spin(document.getElementById("overlay"));
$(".spinner").css("top","200px")},stopSpinning:function(){this.spinner.stop()},readyStateHandler:function(a){vi2.observer.updateVideo(this.seqList[this.seqNum].id,this.seqNum)},timeUpdateHandler:function(a){2===this.video.readyState?this.startSpinning():4===this.video.readyState&&this.stopSpinning()},endedHandler:function(a){vi2.observer.log({context:"player",action:"video-ended",values:[this.url]});vi2.observer.ended();this.video.removeEventListener("ended",arguments.callee,!1);this.isSequence&&
(this.seqNum+1<this.seqList.length||this.seqLoop)?(this.seqNum=(this.seqNum+1)%this.seqList.length,this.loadVideo(this.seqList[this.seqNum].url)):$(vi2.observer.player).trigger("video.end",null)},keyboardCommandHandler:function(a){a.preventDefault();this.video.focus();switch(a.which){case 32:this.play();break;case 189:vi2.observer.getWidget("playbackSpeed").decreaseSpeed();break;case 187:vi2.observer.getWidget("playbackSpeed").increaseSpeed();break;case 38:this.increaseVolume();break;case 40:this.decreaseVolume();
break;case 77:this.muteVolume();break;case 39:vi2.observer.widget_list.toc.nextElement();break;case 37:vi2.observer.widget_list.toc.previousElement();break;case 34:vi2.observer.player.play();break;case 33:vi2.observer.widget_list.toc.previousElement()}this.video.focus()},play:function(){!1===this.video.paused?(this.video.pause(),this.isPlaying(!1),$(vi2.observer.player).trigger("player.pause",[]),vi2.observer.clock.stopClock(),vi2.observer.log({context:"player",action:"pause-click",values:["1"]})):
(this.video.play(),this.isPlaying(!0),$(vi2.observer.player).trigger("player.play",[]),vi2.observer.clock.startClock(),vi2.observer.log({context:"player",action:"play-click",values:["1"]}))},pause:function(){this.video.pause();this.isPlaying(!1);$(vi2.observer.player).bind("player.pause");vi2.observer.log({context:"player",action:"pause2-click",values:["1"]})},isPlaying:function(a){if(void 0===a)return this.videoIsPlaying;this.videoIsPlaying=a},duration:function(){return this.video.duration},currentTime:function(a){if(void 0===
a)return this.video.currentTime;$(this.video).trigger("play");this.video.currentTime=a;this.play()},width:function(a){if(null===a)return $("#video1").width();this.video.width=a},height:function(a){if(null===a)return $("#video1").height();this.video.height=a},errorHandling:function(a){},logger:function(){function a(){var a;a=Math.round(e.currentTime())/c>>0;a!=f&&(vi2.observer.log({context:"player",action:"playback",values:[a]}),f=a)}function b(){g=clearInterval(g);a()}var e=this,c=5,f=-1,g;this.video.addEventListener("play",
function(b){g&&(g=clearInterval(g));g=setInterval(a,1E3*c);setTimeout(a,100)});this.video.addEventListener("pause",function(a){b()});this.video.addEventListener("abort",function(a){b()});this.video.addEventListener("timeupdate",function(a){});this.video.addEventListener("ended",function(a){b()},!1)}});
Vi2.PlaybackSpeed=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a);this.video=document.getElementById(this.options.videoSelector)},name:"playbackSpeed",type:"player-widget",options:{selector:".control-bar",videoSelector:"video1",speed_steps:[0.3,0.5,0.7,1,1.5,1.7,2]},speed:1,video:"",speedIndex:3,init:function(a){var b=this;$(this.options.selector+"> .vi2-speed-controls").remove();a=$("<div></div>").append($("<div></div>").text("1.0x").addClass("speed-label")).addClass("vi2-speed-controls").bind("mouseenter",
function(a){$(".vi2-speed-controls > ul").css("display","block")}).bind("mouseleave",function(a){$(".vi2-speed-controls > ul").css("display","none")}).tooltip({delay:0,showURL:!1,bodyHandler:function(){return $("<span></span>").text("Wiedergabegeschwindigkeit")}}).appendTo(this.options.selector);var e=$("<ul></ul>").addClass("select-speed").appendTo(a);$.each(this.options.speed_steps,function(a,f){$("<li></li>").attr("speed",f).text(f+"x").click(function(a){b.setCurrentSpeed($(this).attr("speed"))}).appendTo(e)})},
displaySpeed:function(){},getCurrentSpeed:function(){return this.speed},setCurrentSpeed:function(a){-1!==this.options.speed_steps.indexOf(parseFloat(a))&&(vi2.observer.log({context:"playbackSpeed",action:"change-speed",values:[this.speed,a]}),this.video.defaultPlaybackRate=1,this.speed=this.video.playbackRate=a,this.speedIndex=this.options.speed_steps.indexOf(parseFloat(a)),$(".speed-label").text(a+"x"),$(".vi2-speed-controls > ul").css("display","none"))},increaseSpeed:function(){this.speedIndex<
this.options.speed_steps.length&&this.setCurrentSpeed(this.options.speed_steps[this.speedIndex+1])},decreaseSpeed:function(){1<this.speedIndex&&this.setCurrentSpeed(this.options.speed_steps[this.speedIndex-1])}});
Vi2.SkipBack=$.inherit({__constructor:function(a){this.options=$.extend(this.options,a)},name:"skipBack",type:"player-widget",options:{selector:".control-bar",label:"",step:5},init:function(){$(this.options.selector+"> .vi2-skipback-controls").remove();var a=this;$("<div></div>").append($("<div></div>").text(this.options.label).addClass("vi2-skipback-label glyphicon glyphicon-step-backward")).addClass("vi2-skipback-controls vi2-btn").attr("title",this.options.step+"s zur\u00fcckspringen").bind("click",
function(b){b=vi2.observer.player.currentTime();var e=Number(Number(b)-Number(a.options.step));vi2.observer.log({context:"skipBack",action:"skip-back",values:[b,String(e)]});vi2.observer.player.currentTime(e)}).prependTo(this.options.selector)}});
Vi2.Maintain=$.inherit({__constructor:function(){},validateTags:function(){var a=[];$.each(this.json_data._taxonomy,function(b,c){$.each(c.sub,function(b,c){a.push(c)})});var b=[];$.each(this.json_data._stream,function(a,c){$.each(this.tags,function(a,c){b.push(c.tagname)})});$.each(a,function(a,c){-1===$.inArray(c,b)&&$("#debug").append(c+", ")})},validateTags2:function(){var a=[];$.each(this.json_data._taxonomy,function(b,e){$.each(e.sub,function(b,e){a.push(e)});a.push(e.id)});$.each(this.json_data._stream,
function(b,e){$("#debug").append("Not found in "+e.id+": ");$.each(this.tags,function(b,e){-1===$.inArray(e.tagname,a)&&$("#debug").append(e.tagname+", ")});$("#debug").append("<br/>")})},validateLinks:function(){$.each(this.json_data._stream,function(a,b){$("#debug").append("["+b.id+"] "+b.metadata[0].title+" ("+b.metadata[0].author+"):<br/>");$.each(this.links,function(a,b){$("#debug").append('"'+b.id+'" @ '+b.start+" => "+b.text+"<br/>")});$("#debug").append("<br/>")})},generateButter:function(a){var b=
vi2.db.getStreamById(a).video;b.replace("http://141.46.8.101/beta/e2script/","http://127.0.0.1:3033/static/videos/");var b='{"template":"basic","title":"'+a+'","guid":"AA41AB3B-D145-477E-A264-3B42701F1E85", "project": {"targets":[{"id":0,"name":"Area1"},{"id":1,"name":"pop-container"}],"media":[ {"id":"Media0","name":"Media01327337635028","url":"'+("http://127.0.0.1:3033"+b)+'","target":"main","duration":4829.205,"tracks":[',e="",c="",f="",g="";$.each(vi2.db.getStreamById(a,!0).slides,function(a,
b){0===a%2?f+='{"id":"TrackEvent'+a+'","type":"image","popcornOptions": {"start":'+this.starttime+',"end":'+(Number(this.starttime)+Number(this.duration))+',"href":"","src":"http://127.0.0.1:3033/static/slides/'+this.img+'","text":"","target":"Area1"}, "track":"Track1327337639244","name":"Track1327337639'+Math.ceil(1E3*Math.random())+'"},':g+='{"id":"TrackEvent'+a+'","type":"image","popcornOptions": {"start":'+this.starttime+',"end":'+(Number(this.starttime)+Number(this.duration))+',"href":"","src":"http://127.0.0.1:3033/static/slides/'+
this.img+'","text":"","target":"Area1"}, "track":"Track1327337639255","name":"Track1327337639'+Math.ceil(1E3*Math.random())+'"},'});e='{"name":"Track1327337639244","id":"Track0", "trackEvents":['+f.substr(0,f.length-1)+"]},";c='{"name":"Track1327337639255","id":"Track1", "trackEvents":['+g.substr(0,g.length-1)+"]}";b+=e+c+"]}]}}";console.log("-------------------------------");console.log(b);console.log("-------------------------------")},json_import:function(){var a=this,b="",e="";$.ajax({type:"POST",
dataType:"json",url:"./data_slide_update.json",success:function(c){$.each(c.data,function(c,g){e="";$.each(g.project.media,function(b,c){$.each(c.tracks,function(b,c){$.each(c.trackEvents,function(b,c){"image"===c.type?e+='{ "type":"seq", "starttime":'+c.popcornOptions.start+', "duration":'+(c.popcornOptions.end-c.popcornOptions.start)+', "id":"", "img":"'+String(c.popcornOptions.src).replace("http://elearning.ihi-zittau.de/beta/iwrm/slides/"+g.title+"/","")+'" },':"pop"===c.type&&(e+="#x: "+c.popcornOptions.left+
"  #y: "+c.popcornOptions.top+"  #start: "+a.seconds2deci(c.popcornOptions.start)+"  #dur: "+(c.popcornOptions.end-c.popcornOptions.start)+"  #text: "+c.popcornOptions.text+"  #target: "+c.popcornOptions.link,e+="\n")})})});b+='\n { "id": "'+g.title+'", "slides":['+e.substr(0,e.length-1)+"]},\n"});c='{ "_name": "vi2 slides", "_slides": [\n'+b.substr(0,b.length-1);c+="\n]}";$("#debug").html(c)},error:function(a,b,e){alert("error at json import "+b)}})},seconds2deci:function(a){a=new Date(Math.ceil(1E3*
a));return a.getHours()-1+":"+a.getMinutes()+":"+a.getSeconds()},validateImages:function(){var a="#!/bin/bash \n";new Image;$.each(this.json_slide_data._slides,function(b,e){var c=e.id;a+="mkdir "+e.id;$.each(e.slides,function(b,g){a+="cp ./"+c+"/"+g.img+" /"+e.id+" ;"})});$("#debug").html(a)},test:function(){var a='{"template":"basic","title":"cullmann","guid":"AA41AB3B-D145-477E-A264-3B42701F1E85", "project": {"targets":[{"id":0,"name":"Area1"},{"id":1,"name":"pop-container"}],"media":[ {"id":"Media0","name":"Media01327337635028","url":"http://127.0.0.1:3033/static/videos/iwrm_cullmann.ogv","target":"main","duration":4829.205,"tracks":[',
b="",e="",c="",f="";$.ajax({type:"POST",dataType:"json",url:"http://127.0.0.1:3033/static/data-slides.json",success:function(g){$.each(g._slides,function(a,b){"cullmann"==b.id&&$.each(b.slides,function(a,b){0===a%2?c+='{"id":"TrackEvent'+a+'","type":"image","popcornOptions": {"start":'+this.starttime+',"end":'+(this.starttime+this.duration)+',"href":"","src":"http://127.0.0.1:3033/static/slides/cullmann/'+this.img+'","text":"","target":"Area1"}, "track":"Track1327337639244","name":"Track1327337639'+
Math.ceil(1E3*Math.random())+'"},':f+='{"id":"TrackEvent'+a+'","type":"image","popcornOptions": {"start":'+this.starttime+',"end":'+(this.starttime+this.duration)+',"href":"","src":"http://127.0.0.1:3033/static/slides/cullmann/'+this.img+'","text":"","target":"Area1"}, "track":"Track1327337639255","name":"Track1327337639'+Math.ceil(1E3*Math.random())+'"},'})});b='{"name":"Track1327337639244","id":"Track0", "trackEvents":['+c.substr(0,c.length-1)+"]},";e='{"name":"Track1327337639255","id":"Track1", "trackEvents":['+
f.substr(0,f.length-1)+"]}";a+=b+e+"]}]}}";$("#debug").html(a)},error:function(a){alert("error at json import")}})},chord:function(){var a=this,b="",e="";$.ajax({type:"POST",dataType:"json",url:"./data.json",success:function(c){$.each(c._stream,function(c,g){e="";$.each(g.links,function(b,c){var f=String(a.getStreamById(g.id).metadata[0].category).replace(/\ /g,"").replace(/\_/g,"").replace(/\-/g,"").toLowerCase();e+='"flare.'+f+"."+c.text+'.x",'});b+='{"name":"flare.'+String(this.metadata[0].category).replace(/\ /g,
"").replace(/\_/g,"").replace(/\-/g,"").toLowerCase()+"."+g.id+'.x","size":1699,"imports":['+e.slice(0,e.length-1)+"]},"});$("#debug").html(b.slice(0,b.length-1))}})}});
